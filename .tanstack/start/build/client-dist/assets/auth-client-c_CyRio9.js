import{m as qe,h as We,P as He,_ as Je}from"./cn-BW4RVDli.js";import{s as Ge,d as he,m as Oe,g as Qe,I as L,J as Ke,K as oe,f as Xe,N as Pe,o as me,Q as Re,i as Ye,R as ye,T as Ze,U as et}from"./main-Dn08EaJy.js";var tt={};Je(tt,{Root:()=>Ie,Separator:()=>rt});function Ie(e){let r;const s=qe({orientation:"horizontal"},e),[t,i]=Ge(s,["ref","orientation"]),n=We(()=>r,()=>"hr");return he(He,Oe({as:"hr",ref(a){var o=Qe(d=>r=d,t.ref);typeof o=="function"&&o(a)},get role(){return n()!=="hr"?"separator":void 0},get"aria-orientation"(){return t.orientation==="vertical"?"vertical":void 0},get"data-orientation"(){return t.orientation}},i))}var rt=Ie;function ve(e,r){return typeof e=="function"?e(r):e}function x(e,r){return ge(r).reduce((t,i)=>{if(t===null)return null;if(typeof t<"u")return t[i]},e)}function W(e,r,s){const t=ge(r);function i(n){if(!t.length)return ve(s,n);const a=t.shift();if(typeof a=="string"||typeof a=="number"&&!Array.isArray(n))return typeof n=="object"?(n===null&&(n={}),{...n,[a]:i(n[a])}):{[a]:i()};if(Array.isArray(n)&&typeof a=="number"){const o=n.slice(0,a);return[...o.length?o:new Array(a),i(n[a]),...n.slice(a+1)]}return[...new Array(a),i()]}return i(e)}function st(e,r){const s=ge(r);function t(i){if(!i)return;if(s.length===1){const a=s[0];if(Array.isArray(i)&&typeof a=="number")return i.filter((l,u)=>u!==a);const{[a]:o,...d}=i;return d}const n=s.shift();if(typeof n=="string"&&typeof i=="object")return{...i,[n]:t(i[n])};if(typeof n=="number"&&Array.isArray(i)){if(n>=i.length)return i;const a=i.slice(0,n);return[...a.length?a:new Array(n),t(i[n]),...i.slice(n+1)]}throw new Error("It seems we have created an infinite loop in deleteBy. ")}return t(e)}const it=/^(\d+)$/gm,nt=/\.(\d+)(?=\.)/gm,at=/^(\d+)\./gm,ot=/\.(\d+$)/gm,lt=/\.{2,}/gm,le="__int__",H=`${le}$1`;function ge(e){if(Array.isArray(e))return[...e];if(typeof e!="string")throw new Error("Path must be a string.");return e.replace(/(^\[)|]/gm,"").replace(/\[/g,".").replace(it,H).replace(nt,`.${H}.`).replace(at,`${H}.`).replace(ot,`.${H}`).replace(lt,".").split(".").map(r=>r.indexOf(le)===0?parseInt(r.substring(le.length),10):r)}function ut(e){return!(Array.isArray(e)&&e.length===0)}function ue(e,r){const{asyncDebounceMs:s}=r,{onChangeAsync:t,onBlurAsync:i,onSubmitAsync:n,onBlurAsyncDebounceMs:a,onChangeAsyncDebounceMs:o}=r.validators||{},d=s??0,l={cause:"change",validate:t,debounceMs:o??d},u={cause:"blur",validate:i,debounceMs:a??d},f={cause:"submit",validate:n,debounceMs:0},c=v=>({...v,debounceMs:0});switch(e){case"submit":return[c(l),c(u),f];case"blur":return[u];case"change":return[l];case"server":default:return[]}}function ce(e,r){const{onChange:s,onBlur:t,onSubmit:i,onMount:n}=r.validators||{},a={cause:"change",validate:s},o={cause:"blur",validate:t},d={cause:"submit",validate:i},l={cause:"mount",validate:n},u={cause:"server",validate:()=>{}};switch(e){case"mount":return[l];case"submit":return[a,o,d,u];case"server":return[u];case"blur":return[o,u];case"change":default:return[a,u]}}const de=e=>!!e&&typeof e=="object"&&"fields"in e;function N(e,r){if(Object.is(e,r))return!0;if(typeof e!="object"||e===null||typeof r!="object"||r===null)return!1;if(e instanceof Map&&r instanceof Map){if(e.size!==r.size)return!1;for(const[i,n]of e)if(!r.has(i)||!Object.is(n,r.get(i)))return!1;return!0}if(e instanceof Set&&r instanceof Set){if(e.size!==r.size)return!1;for(const i of e)if(!r.has(i))return!1;return!0}const s=Object.keys(e),t=Object.keys(r);if(s.length!==t.length)return!1;for(const i of s)if(!t.includes(i)||!N(e[i],r[i]))return!1;return!0}const Me=({newFormValidatorError:e,isPreviousErrorFromFormValidator:r,previousErrorValue:s})=>e?{newErrorValue:e,newSource:"form"}:r?{newErrorValue:void 0,newSource:void 0}:s?{newErrorValue:s,newSource:"field"}:{newErrorValue:void 0,newSource:void 0},be=({formLevelError:e,fieldLevelError:r})=>r?{newErrorValue:r,newSource:"field"}:e?{newErrorValue:e,newSource:"form"}:{newErrorValue:void 0,newSource:void 0};function ct(e){const r=new Map;for(const s of e){const t=[...s.path??[]].map(i=>{const n=typeof i=="object"?i.key:i;return typeof n=="number"?`[${n}]`:n}).join(".").replace(/\.\[/g,"[");r.set(t,(r.get(t)??[]).concat(s))}return Object.fromEntries(r)}const Se=e=>{const r=ct(e);return{form:r,fields:r}},j={validate({value:e,validationSource:r},s){const t=s["~standard"].validate(e);if(t instanceof Promise)throw new Error("async function passed to sync validator");if(t.issues)return r==="field"?t.issues:Se(t.issues)},async validateAsync({value:e,validationSource:r},s){const t=await s["~standard"].validate(e);if(t.issues)return r==="field"?t.issues:Se(t.issues)}},Le=e=>!!e&&"~standard"in e,se={isValidating:!1,isTouched:!1,isBlurred:!1,isDirty:!1,isPristine:!0,isValid:!0,isDefaultValue:!0,errors:[],errorMap:{},errorSourceMap:{}};function J(e){function r(f,c,v,h){const p=t(f,c,v,h);({insert:()=>o(p,f,c),remove:()=>d(p),swap:()=>h!==void 0&&u(p,f,c,h),move:()=>h!==void 0&&l(p,f,c,h)})[v]()}function s(f,c){return`${f}[${c}]`}function t(f,c,v,h){const p=[s(f,c)];if(v==="swap")p.push(s(f,h));else if(v==="move"){const[g,y]=[Math.min(c,h),Math.max(c,h)];for(let m=g;m<=y;m++)p.push(s(f,m))}else{const g=e.getFieldValue(f),y=Array.isArray(g)?g.length:0;for(let m=c+1;m<y;m++)p.push(s(f,m))}return Object.keys(e.fieldInfo).filter(g=>p.some(y=>g.startsWith(y)))}function i(f,c){return f.replace(/\[(\d+)\]/,(v,h)=>{const p=parseInt(h,10);return`[${c==="up"?p+1:Math.max(0,p-1)}]`})}function n(f,c){(c==="up"?f:[...f].reverse()).forEach(h=>{const p=i(h.toString(),c),g=e.getFieldMeta(p);g?e.setFieldMeta(h,g):e.setFieldMeta(h,a())})}const a=()=>se,o=(f,c,v)=>{n(f,"down"),f.forEach(h=>{h.toString().startsWith(s(c,v))&&e.setFieldMeta(h,a())})},d=f=>{n(f,"up")},l=(f,c,v,h)=>{const p=new Map(Object.keys(e.fieldInfo).filter(g=>g.startsWith(s(c,v))).map(g=>[g,e.getFieldMeta(g)]));n(f,v<h?"up":"down"),Object.keys(e.fieldInfo).filter(g=>g.startsWith(s(c,h))).forEach(g=>{const y=g.replace(s(c,h),s(c,v)),m=p.get(y);m&&e.setFieldMeta(g,m)})},u=(f,c,v,h)=>{f.forEach(p=>{if(!p.toString().startsWith(s(c,v)))return;const g=p.toString().replace(s(c,v),s(c,h)),[y,m]=[e.getFieldMeta(p),e.getFieldMeta(g)];y&&e.setFieldMeta(g,y),m&&e.setFieldMeta(p,m)})};return{handleArrayFieldMetaShift:r}}function ne(e){return{values:e.values??{},errorMap:e.errorMap??{},fieldMetaBase:e.fieldMetaBase??{},isSubmitted:e.isSubmitted??!1,isSubmitting:e.isSubmitting??!1,isValidating:e.isValidating??!1,submissionAttempts:e.submissionAttempts??0,isSubmitSuccessful:e.isSubmitSuccessful??!1,validationMetaMap:e.validationMetaMap??{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0}}}class dt{constructor(r){var s;this.options={},this.fieldInfo={},this.prevTransformArray=[],this.mount=()=>{var t,i;const n=this.fieldMetaDerived.mount(),a=this.store.mount(),o=()=>{n(),a()};(i=(t=this.options.listeners)==null?void 0:t.onMount)==null||i.call(t,{formApi:this});const{onMount:d}=this.options.validators||{};return d&&this.validateSync("mount"),o},this.update=t=>{var i,n;if(!t)return;const a=this.options;this.options=t;const o=!!((n=(i=t.transform)==null?void 0:i.deps)!=null&&n.some((u,f)=>u!==this.prevTransformArray[f])),d=t.defaultValues&&!N(t.defaultValues,a.defaultValues)&&!this.state.isTouched,l=!N(t.defaultState,a.defaultState)&&!this.state.isTouched;!d&&!l&&!o||L(()=>{this.baseStore.setState(()=>ne(Object.assign({},this.state,l?t.defaultState:{},d?{values:t.defaultValues}:{},o?{_force_re_eval:!this.state._force_re_eval}:{})))})},this.reset=(t,i)=>{const{fieldMeta:n}=this.state,a=this.resetFieldMeta(n);t&&!(i!=null&&i.keepDefaultValues)&&(this.options={...this.options,defaultValues:t}),this.baseStore.setState(()=>{var o;return ne({...this.options.defaultState,values:t??this.options.defaultValues??((o=this.options.defaultState)==null?void 0:o.values),fieldMetaBase:a})})},this.validateAllFields=async t=>{const i=[];return L(()=>{Object.values(this.fieldInfo).forEach(a=>{if(!a.instance)return;const o=a.instance;i.push(Promise.resolve().then(()=>o.validate(t,{skipFormValidation:!0}))),a.instance.state.meta.isTouched||a.instance.setMeta(d=>({...d,isTouched:!0}))})}),(await Promise.all(i)).flat()},this.validateArrayFieldsStartingFrom=async(t,i,n)=>{const a=this.getFieldValue(t),o=Array.isArray(a)?Math.max(a.length-1,0):null,d=[`${t}[${i}]`];for(let c=i+1;c<=(o??0);c++)d.push(`${t}[${c}]`);const l=Object.keys(this.fieldInfo).filter(c=>d.some(v=>c.startsWith(v))),u=[];return L(()=>{l.forEach(c=>{u.push(Promise.resolve().then(()=>this.validateField(c,n)))})}),(await Promise.all(u)).flat()},this.validateField=(t,i)=>{var n;const a=(n=this.fieldInfo[t])==null?void 0:n.instance;return a?(a.state.meta.isTouched||a.setMeta(o=>({...o,isTouched:!0})),a.validate(i)):[]},this.validateSync=t=>{const i=ce(t,this.options);let n=!1;const a={};return L(()=>{var o,d;for(const u of i){if(!u.validate)continue;const f=this.runValidator({validate:u.validate,value:{value:this.state.values,formApi:this,validationSource:"form"},type:"validate"}),{formError:c,fieldErrors:v}=Z(f),h=G(u.cause);for(const p of Object.keys(this.state.fieldMeta)){const g=this.getFieldMeta(p);if(!g)continue;const{errorMap:y,errorSourceMap:m}=g,S=v==null?void 0:v[p],{newErrorValue:M,newSource:V}=Me({newFormValidatorError:S,isPreviousErrorFromFormValidator:(m==null?void 0:m[h])==="form",previousErrorValue:y==null?void 0:y[h]});V==="form"&&(a[p]={...a[p],[h]:S}),(y==null?void 0:y[h])!==M&&this.setFieldMeta(p,b=>({...b,errorMap:{...b.errorMap,[h]:M},errorSourceMap:{...b.errorSourceMap,[h]:V}}))}((o=this.state.errorMap)==null?void 0:o[h])!==c&&this.baseStore.setState(p=>({...p,errorMap:{...p.errorMap,[h]:c}})),(c||v)&&(n=!0)}const l=G("submit");(d=this.state.errorMap)!=null&&d[l]&&t!=="submit"&&!n&&this.baseStore.setState(u=>({...u,errorMap:{...u.errorMap,[l]:void 0}}))}),{hasErrored:n,fieldsErrorMap:a}},this.validateAsync=async t=>{const i=ue(t,this.options);this.state.isFormValidating||this.baseStore.setState(l=>({...l,isFormValidating:!0}));const n=[];let a;for(const l of i){if(!l.validate)continue;const u=G(l.cause),f=this.state.validationMetaMap[u];f==null||f.lastAbortController.abort();const c=new AbortController;this.state.validationMetaMap[u]={lastAbortController:c},n.push(new Promise(async v=>{let h;try{h=await new Promise((m,S)=>{setTimeout(async()=>{if(c.signal.aborted)return m(void 0);try{m(await this.runValidator({validate:l.validate,value:{value:this.state.values,formApi:this,validationSource:"form",signal:c.signal},type:"validateAsync"}))}catch(M){S(M)}},l.debounceMs)})}catch(m){h=m}const{formError:p,fieldErrors:g}=Z(h);g&&(a=a?{...a,...g}:g);const y=G(l.cause);for(const m of Object.keys(this.state.fieldMeta)){const S=this.getFieldMeta(m);if(!S)continue;const{errorMap:M,errorSourceMap:V}=S,b=a==null?void 0:a[m],{newErrorValue:E,newSource:D}=Me({newFormValidatorError:b,isPreviousErrorFromFormValidator:(V==null?void 0:V[y])==="form",previousErrorValue:M==null?void 0:M[y]});(M==null?void 0:M[y])!==E&&this.setFieldMeta(m,F=>({...F,errorMap:{...F.errorMap,[y]:E},errorSourceMap:{...F.errorSourceMap,[y]:D}}))}this.baseStore.setState(m=>({...m,errorMap:{...m.errorMap,[y]:p}})),v(a?{fieldErrors:a,errorMapKey:y}:void 0)}))}let o=[];const d={};if(n.length){o=await Promise.all(n);for(const l of o)if(l!=null&&l.fieldErrors){const{errorMapKey:u}=l;for(const[f,c]of Object.entries(l.fieldErrors)){const h={...d[f]||{},[u]:c};d[f]=h}}}return this.baseStore.setState(l=>({...l,isFormValidating:!1})),d},this.validate=t=>{const{hasErrored:i,fieldsErrorMap:n}=this.validateSync(t);return i&&!this.options.asyncAlways?n:this.validateAsync(t)},this.getFieldValue=t=>x(this.state.values,t),this.getFieldMeta=t=>this.state.fieldMeta[t],this.getFieldInfo=t=>{var i;return(i=this.fieldInfo)[t]||(i[t]={instance:null,validationMetaMap:{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0}})},this.setFieldMeta=(t,i)=>{this.baseStore.setState(n=>({...n,fieldMetaBase:{...n.fieldMetaBase,[t]:ve(i,n.fieldMetaBase[t])}}))},this.resetFieldMeta=t=>Object.keys(t).reduce((i,n)=>{const a=n;return i[a]=se,i},{}),this.setFieldValue=(t,i,n)=>{const a=(n==null?void 0:n.dontUpdateMeta)??!1;L(()=>{a||this.setFieldMeta(t,o=>({...o,isTouched:!0,isDirty:!0,errorMap:{...o==null?void 0:o.errorMap,onMount:void 0}})),this.baseStore.setState(o=>({...o,values:W(o.values,t,i)}))})},this.deleteField=t=>{const n=[...Object.keys(this.fieldInfo).filter(a=>{const o=t.toString();return a!==o&&a.startsWith(o)}),t];this.baseStore.setState(a=>{const o={...a};return n.forEach(d=>{o.values=st(o.values,d),delete this.fieldInfo[d],delete o.fieldMetaBase[d]}),o})},this.pushFieldValue=(t,i,n)=>{this.setFieldValue(t,a=>[...Array.isArray(a)?a:[],i],n),this.validateField(t,"change")},this.insertFieldValue=async(t,i,n,a)=>{this.setFieldValue(t,o=>[...o.slice(0,i),n,...o.slice(i)],a),await this.validateField(t,"change"),J(this).handleArrayFieldMetaShift(t,i,"insert"),await this.validateArrayFieldsStartingFrom(t,i,"change")},this.replaceFieldValue=async(t,i,n,a)=>{this.setFieldValue(t,o=>o.map((d,l)=>l===i?n:d),a),await this.validateField(t,"change"),await this.validateArrayFieldsStartingFrom(t,i,"change")},this.removeFieldValue=async(t,i,n)=>{const a=this.getFieldValue(t),o=Array.isArray(a)?Math.max(a.length-1,0):null;if(this.setFieldValue(t,d=>d.filter((l,u)=>u!==i),n),J(this).handleArrayFieldMetaShift(t,i,"remove"),o!==null){const d=`${t}[${o}]`;this.deleteField(d)}await this.validateField(t,"change"),await this.validateArrayFieldsStartingFrom(t,i,"change")},this.swapFieldValues=(t,i,n,a)=>{this.setFieldValue(t,o=>{const d=o[i],l=o[n];return W(W(o,`${i}`,l),`${n}`,d)},a),J(this).handleArrayFieldMetaShift(t,i,"swap",n),this.validateField(t,"change"),this.validateField(`${t}[${i}]`,"change"),this.validateField(`${t}[${n}]`,"change")},this.moveFieldValues=(t,i,n,a)=>{this.setFieldValue(t,o=>{const d=[...o];return d.splice(n,0,d.splice(i,1)[0]),d},a),J(this).handleArrayFieldMetaShift(t,i,"move",n),this.validateField(t,"change"),this.validateField(`${t}[${i}]`,"change"),this.validateField(`${t}[${n}]`,"change")},this.clearFieldValues=(t,i)=>{const n=this.getFieldValue(t),a=Array.isArray(n)?Math.max(n.length-1,0):null;if(this.setFieldValue(t,[],i),a!==null)for(let o=0;o<=a;o++){const d=`${t}[${o}]`;this.deleteField(d)}this.validateField(t,"change")},this.resetField=t=>{this.baseStore.setState(i=>({...i,fieldMetaBase:{...i.fieldMetaBase,[t]:se},values:this.options.defaultValues?W(i.values,t,x(this.options.defaultValues,t)):i.values}))},this.getAllErrors=()=>({form:{errors:this.state.errors,errorMap:this.state.errorMap},fields:Object.entries(this.state.fieldMeta).reduce((t,[i,n])=>(Object.keys(n).length&&n.errors.length&&(t[i]={errors:n.errors,errorMap:n.errorMap}),t),{})}),this.parseValuesWithSchema=t=>j.validate({value:this.state.values,validationSource:"form"},t),this.parseValuesWithSchemaAsync=t=>j.validateAsync({value:this.state.values,validationSource:"form"},t),this.baseStore=new Ke(ne({...r==null?void 0:r.defaultState,values:(r==null?void 0:r.defaultValues)??((s=r==null?void 0:r.defaultState)==null?void 0:s.values)})),this.fieldMetaDerived=new oe({deps:[this.baseStore],fn:({prevDepVals:t,currDepVals:i,prevVal:n})=>{var a,o,d;const l=n,u=t==null?void 0:t[0],f=i[0];let c=0;const v={};for(const h of Object.keys(f.fieldMetaBase)){const p=f.fieldMetaBase[h],g=u==null?void 0:u.fieldMetaBase[h],y=l==null?void 0:l[h],m=x(f.values,h);let S=y==null?void 0:y.errors;if(!g||p.errorMap!==g.errorMap){S=Object.values(p.errorMap??{}).filter(D=>D!==void 0);const E=(a=this.getFieldInfo(h))==null?void 0:a.instance;E&&!E.options.disableErrorFlat&&(S=S==null?void 0:S.flat(1))}const M=!ut(S??[]),V=!p.isDirty,b=N(m,x(this.options.defaultValues,h))||N(m,(d=(o=this.getFieldInfo(h))==null?void 0:o.instance)==null?void 0:d.options.defaultValue);if(y&&y.isPristine===V&&y.isValid===M&&y.isDefaultValue===b&&y.errors===S&&p===g){v[h]=y,c++;continue}v[h]={...p,errors:S,isPristine:V,isValid:M,isDefaultValue:b}}return Object.keys(f.fieldMetaBase).length&&l&&c===Object.keys(f.fieldMetaBase).length?l:v}}),this.store=new oe({deps:[this.baseStore,this.fieldMetaDerived],fn:({prevDepVals:t,currDepVals:i,prevVal:n})=>{var a,o,d,l;const u=n,f=t==null?void 0:t[0],c=i[0],v=i[1],h=Object.values(v).filter(Boolean),p=h.some(w=>w.isValidating),g=h.every(w=>w.isValid),y=h.some(w=>w.isTouched),m=h.some(w=>w.isBlurred),S=h.every(w=>w.isDefaultValue),M=y&&((a=c.errorMap)==null?void 0:a.onMount),V=h.some(w=>w.isDirty),b=!V,E=!!((o=c.errorMap)!=null&&o.onMount||h.some(w=>{var I;return(I=w==null?void 0:w.errorMap)==null?void 0:I.onMount})),D=!!p;let F=(u==null?void 0:u.errors)??[];(!f||c.errorMap!==f.errorMap)&&(F=Object.values(c.errorMap).reduce((w,I)=>I===void 0?w:I&&de(I)?(w.push(I.form),w):(w.push(I),w),[]));const $=F.length===0,U=g&&$,ie=this.options.canSubmitWhenInvalid??!1,A=c.submissionAttempts===0&&!y&&!E||!D&&!c.isSubmitting&&U||ie;let _=c.errorMap;if(M&&(F=F.filter(w=>w!==c.errorMap.onMount),_=Object.assign(_,{onMount:void 0})),u&&f&&u.errorMap===_&&u.fieldMeta===this.fieldMetaDerived.state&&u.errors===F&&u.isFieldsValidating===p&&u.isFieldsValid===g&&u.isFormValid===$&&u.isValid===U&&u.canSubmit===A&&u.isTouched===y&&u.isBlurred===m&&u.isPristine===b&&u.isDefaultValue===S&&u.isDirty===V&&N(f,c))return u;let T={...c,errorMap:_,fieldMeta:this.fieldMetaDerived.state,errors:F,isFieldsValidating:p,isFieldsValid:g,isFormValid:$,isValid:U,canSubmit:A,isTouched:y,isBlurred:m,isPristine:b,isDefaultValue:S,isDirty:V};const O=((d=this.options.transform)==null?void 0:d.deps)??[];if(O.length!==this.prevTransformArray.length||O.some((w,I)=>w!==this.prevTransformArray[I])){const w=Object.assign({},this,{state:T});(l=this.options.transform)==null||l.fn(w),T=w.state,this.prevTransformArray=O}return T}}),this.handleSubmit=this.handleSubmit.bind(this),this.update(r||{})}get state(){return this.store.state}runValidator(r){return Le(r.validate)?j[r.type](r.value,r.validate):r.validate(r.value)}async handleSubmit(r){var s,t,i,n,a,o,d,l;if(this.baseStore.setState(f=>({...f,isSubmitted:!1,submissionAttempts:f.submissionAttempts+1,isSubmitSuccessful:!1})),L(()=>{Object.values(this.fieldInfo).forEach(f=>{f.instance&&(f.instance.state.meta.isTouched||f.instance.setMeta(c=>({...c,isTouched:!0})))})}),!this.state.canSubmit)return;this.baseStore.setState(f=>({...f,isSubmitting:!0}));const u=()=>{this.baseStore.setState(f=>({...f,isSubmitting:!1}))};if(await this.validateAllFields("submit"),!this.state.isFieldsValid){u(),(t=(s=this.options).onSubmitInvalid)==null||t.call(s,{value:this.state.values,formApi:this});return}if(await this.validate("submit"),!this.state.isValid){u(),(n=(i=this.options).onSubmitInvalid)==null||n.call(i,{value:this.state.values,formApi:this});return}L(()=>{Object.values(this.fieldInfo).forEach(f=>{var c,v,h;(h=(v=(c=f.instance)==null?void 0:c.options.listeners)==null?void 0:v.onSubmit)==null||h.call(v,{value:f.instance.state.value,fieldApi:f.instance})})}),(o=(a=this.options.listeners)==null?void 0:a.onSubmit)==null||o.call(a,{formApi:this});try{await((l=(d=this.options).onSubmit)==null?void 0:l.call(d,{value:this.state.values,formApi:this,meta:r??this.options.onSubmitMeta})),L(()=>{this.baseStore.setState(f=>({...f,isSubmitted:!0,isSubmitSuccessful:!0})),u()})}catch(f){throw this.baseStore.setState(c=>({...c,isSubmitSuccessful:!1})),u(),f}}setErrorMap(r){L(()=>{Object.entries(r).forEach(([s,t])=>{const i=s;if(de(t)){const{formError:n,fieldErrors:a}=Z(t);for(const o of Object.keys(this.fieldInfo))this.getFieldMeta(o)&&this.setFieldMeta(o,l=>({...l,errorMap:{...l.errorMap,[i]:a==null?void 0:a[o]},errorSourceMap:{...l.errorSourceMap,[i]:"form"}}));this.baseStore.setState(o=>({...o,errorMap:{...o.errorMap,[i]:n}}))}else this.baseStore.setState(n=>({...n,errorMap:{...n.errorMap,[i]:t}}))})})}}function Z(e){if(e){if(de(e)){const r=Z(e.form).formError,s=e.fields;return{formError:r,fieldErrors:s}}return{formError:e}}return{formError:void 0}}function G(e){switch(e){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"change":default:return"onChange"}}class ft{constructor(r){this.options={},this.mount=()=>{var s,t;const i=this.store.mount();this.options.defaultValue!==void 0&&this.form.setFieldValue(this.name,this.options.defaultValue,{dontUpdateMeta:!0});const n=this.getInfo();n.instance=this,this.update(this.options);const{onMount:a}=this.options.validators||{};if(a){const o=this.runValidator({validate:a,value:{value:this.state.value,fieldApi:this,validationSource:"field"},type:"validate"});o&&this.setMeta(d=>({...d,errorMap:{...d==null?void 0:d.errorMap,onMount:o},errorSourceMap:{...d==null?void 0:d.errorSourceMap,onMount:"field"}}))}return(t=(s=this.options.listeners)==null?void 0:s.onMount)==null||t.call(s,{value:this.state.value,fieldApi:this}),i},this.update=s=>{this.options=s;const t=this.name!==s.name;if(this.name=s.name,this.state.value===void 0){const i=x(s.form.options.defaultValues,s.name),n=s.defaultValue??i;t?this.setValue(a=>a||n,{dontUpdateMeta:!0}):n!==void 0&&this.setValue(n,{dontUpdateMeta:!0})}this.form.getFieldMeta(this.name)===void 0&&this.setMeta(this.state.meta)},this.getValue=()=>this.form.getFieldValue(this.name),this.setValue=(s,t)=>{this.form.setFieldValue(this.name,s,t),this.triggerOnChangeListener(),this.validate("change")},this.getMeta=()=>this.store.state.meta,this.setMeta=s=>this.form.setFieldMeta(this.name,s),this.getInfo=()=>this.form.getFieldInfo(this.name),this.pushValue=(s,t)=>{this.form.pushFieldValue(this.name,s,t),this.triggerOnChangeListener()},this.insertValue=(s,t,i)=>{this.form.insertFieldValue(this.name,s,t,i),this.triggerOnChangeListener()},this.replaceValue=(s,t,i)=>{this.form.replaceFieldValue(this.name,s,t,i),this.triggerOnChangeListener()},this.removeValue=(s,t)=>{this.form.removeFieldValue(this.name,s,t),this.triggerOnChangeListener()},this.swapValues=(s,t,i)=>{this.form.swapFieldValues(this.name,s,t,i),this.triggerOnChangeListener()},this.moveValue=(s,t,i)=>{this.form.moveFieldValues(this.name,s,t,i),this.triggerOnChangeListener()},this.clearValues=s=>{this.form.clearFieldValues(this.name,s),this.triggerOnChangeListener()},this.getLinkedFields=s=>{const t=Object.values(this.form.fieldInfo),i=[];for(const n of t){if(!n.instance)continue;const{onChangeListenTo:a,onBlurListenTo:o}=n.instance.options.validators||{};s==="change"&&(a!=null&&a.includes(this.name))&&i.push(n.instance),s==="blur"&&(o!=null&&o.includes(this.name))&&i.push(n.instance)}return i},this.validateSync=(s,t)=>{var i;const n=ce(s,this.options),o=this.getLinkedFields(s).reduce((u,f)=>{const c=ce(s,f.options);return c.forEach(v=>{v.field=f}),u.concat(c)},[]);let d=!1;L(()=>{const u=(f,c)=>{var v;const h=Q(c.cause),p=c.validate?we(f.runValidator({validate:c.validate,value:{value:f.store.state.value,validationSource:"field",fieldApi:f},type:"validate"})):void 0,g=t[h],{newErrorValue:y,newSource:m}=be({formLevelError:g,fieldLevelError:p});((v=f.state.meta.errorMap)==null?void 0:v[h])!==y&&f.setMeta(S=>({...S,errorMap:{...S.errorMap,[h]:y},errorSourceMap:{...S.errorSourceMap,[h]:m}})),y&&(d=!0)};for(const f of n)u(this,f);for(const f of o)f.validate&&u(f.field,f)});const l=Q("submit");return(i=this.state.meta.errorMap)!=null&&i[l]&&s!=="submit"&&!d&&this.setMeta(u=>({...u,errorMap:{...u.errorMap,[l]:void 0},errorSourceMap:{...u.errorSourceMap,[l]:void 0}})),{hasErrored:d}},this.validateAsync=async(s,t)=>{const i=ue(s,this.options),n=await t,a=this.getLinkedFields(s),o=a.reduce((c,v)=>{const h=ue(s,v.options);return h.forEach(p=>{p.field=v}),c.concat(h)},[]);this.state.meta.isValidating||this.setMeta(c=>({...c,isValidating:!0}));for(const c of a)c.setMeta(v=>({...v,isValidating:!0}));const d=[],l=[],u=(c,v,h)=>{const p=Q(v.cause),g=c.getInfo().validationMetaMap[p];g==null||g.lastAbortController.abort();const y=new AbortController;this.getInfo().validationMetaMap[p]={lastAbortController:y},h.push(new Promise(async m=>{var S;let M;try{M=await new Promise((F,$)=>{this.timeoutIds.validations[v.cause]&&clearTimeout(this.timeoutIds.validations[v.cause]),this.timeoutIds.validations[v.cause]=setTimeout(async()=>{if(y.signal.aborted)return F(void 0);try{F(await this.runValidator({validate:v.validate,value:{value:c.store.state.value,fieldApi:c,signal:y.signal,validationSource:"field"},type:"validateAsync"}))}catch(U){$(U)}},v.debounceMs)})}catch(F){M=F}if(y.signal.aborted)return m(void 0);const V=we(M),b=(S=n[this.name])==null?void 0:S[p],{newErrorValue:E,newSource:D}=be({formLevelError:b,fieldLevelError:V});c.setMeta(F=>({...F,errorMap:{...F==null?void 0:F.errorMap,[p]:E},errorSourceMap:{...F.errorSourceMap,[p]:D}})),m(E)}))};for(const c of i)c.validate&&u(this,c,d);for(const c of o)c.validate&&u(c.field,c,l);let f=[];(d.length||l.length)&&(f=await Promise.all(d),await Promise.all(l)),this.setMeta(c=>({...c,isValidating:!1}));for(const c of a)c.setMeta(v=>({...v,isValidating:!1}));return f.filter(Boolean)},this.validate=(s,t)=>{var i;if(!this.state.meta.isTouched)return[];const{fieldsErrorMap:n}=t!=null&&t.skipFormValidation?{fieldsErrorMap:{}}:this.form.validateSync(s),{hasErrored:a}=this.validateSync(s,n[this.name]??{});if(a&&!this.options.asyncAlways)return(i=this.getInfo().validationMetaMap[Q(s)])==null||i.lastAbortController.abort(),this.state.meta.errors;const o=t!=null&&t.skipFormValidation?Promise.resolve({}):this.form.validateAsync(s);return this.validateAsync(s,o)},this.handleChange=s=>{this.setValue(s)},this.handleBlur=()=>{this.state.meta.isTouched||this.setMeta(t=>({...t,isTouched:!0})),this.state.meta.isBlurred||this.setMeta(t=>({...t,isBlurred:!0})),this.validate("blur"),this.triggerOnBlurListener()},this.parseValueWithSchema=s=>j.validate({value:this.state.value,validationSource:"field"},s),this.parseValueWithSchemaAsync=s=>j.validateAsync({value:this.state.value,validationSource:"field"},s),this.form=r.form,this.name=r.name,this.timeoutIds={validations:{},listeners:{},formListeners:{}},this.store=new oe({deps:[this.form.store],fn:()=>{const s=this.form.getFieldValue(this.name),t=this.form.getFieldMeta(this.name)??{...se,...r.defaultMeta};return{value:s,meta:t}}}),this.options=r}get state(){return this.store.state}runValidator(r){return Le(r.validate)?j[r.type](r.value,r.validate):r.validate(r.value)}setErrorMap(r){this.setMeta(s=>({...s,errorMap:{...s.errorMap,...r}}))}triggerOnBlurListener(){var r,s,t,i,n,a;const o=(r=this.form.options.listeners)==null?void 0:r.onBlurDebounceMs;o&&o>0?(this.timeoutIds.formListeners.blur&&clearTimeout(this.timeoutIds.formListeners.blur),this.timeoutIds.formListeners.blur=setTimeout(()=>{var l,u;(u=(l=this.form.options.listeners)==null?void 0:l.onBlur)==null||u.call(l,{formApi:this.form,fieldApi:this})},o)):(t=(s=this.form.options.listeners)==null?void 0:s.onBlur)==null||t.call(s,{formApi:this.form,fieldApi:this});const d=(i=this.options.listeners)==null?void 0:i.onBlurDebounceMs;d&&d>0?(this.timeoutIds.listeners.blur&&clearTimeout(this.timeoutIds.listeners.blur),this.timeoutIds.listeners.blur=setTimeout(()=>{var l,u;(u=(l=this.options.listeners)==null?void 0:l.onBlur)==null||u.call(l,{value:this.state.value,fieldApi:this})},d)):(a=(n=this.options.listeners)==null?void 0:n.onBlur)==null||a.call(n,{value:this.state.value,fieldApi:this})}triggerOnChangeListener(){var r,s,t,i,n,a;const o=(r=this.form.options.listeners)==null?void 0:r.onChangeDebounceMs;o&&o>0?(this.timeoutIds.formListeners.change&&clearTimeout(this.timeoutIds.formListeners.change),this.timeoutIds.formListeners.change=setTimeout(()=>{var l,u;(u=(l=this.form.options.listeners)==null?void 0:l.onChange)==null||u.call(l,{formApi:this.form,fieldApi:this})},o)):(t=(s=this.form.options.listeners)==null?void 0:s.onChange)==null||t.call(s,{formApi:this.form,fieldApi:this});const d=(i=this.options.listeners)==null?void 0:i.onChangeDebounceMs;d&&d>0?(this.timeoutIds.listeners.change&&clearTimeout(this.timeoutIds.listeners.change),this.timeoutIds.listeners.change=setTimeout(()=>{var l,u;(u=(l=this.options.listeners)==null?void 0:l.onChange)==null||u.call(l,{value:this.state.value,fieldApi:this})},d)):(a=(n=this.options.listeners)==null?void 0:n.onChange)==null||a.call(n,{value:this.state.value,fieldApi:this})}}function we(e){if(e)return e}function Q(e){switch(e){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"change":default:return"onChange"}}function ht(e){const[r,s]=Ye(e,{equals:!1}),t=e.store.subscribe(()=>s(e));return me(t),r}function ke(e){const r=e(),s=new ft(r),t=s;t.Field=De;let i=!1;return Pe(()=>{const n=s.mount();i=!0,me(()=>{n(),i=!1})}),Re(()=>{i&&s.update(e())}),ht(t)}function De(e){const r=ke(()=>{const{children:s,...t}=e;return t});return Xe(()=>he(()=>e.children(r),{}))}function Sr(e){const r=e==null?void 0:e(),s=new dt(r),t=s;return t.Field=i=>he(De,Oe(i,{form:s})),t.createField=i=>ke(()=>({...i(),form:s})),t.useStore=i=>ye(s.store,i),t.Subscribe=i=>ve(i.children,ye(s.store,i.selector)),Pe(s.mount),Re(()=>s.update(e==null?void 0:e())),t}let P=[],C=0;const K=4;let q=e=>{let r=[],s={get(){return s.lc||s.listen(()=>{})(),s.value},lc:0,listen(t){return s.lc=r.push(t),()=>{for(let n=C+K;n<P.length;)P[n]===t?P.splice(n,K):n+=K;let i=r.indexOf(t);~i&&(r.splice(i,1),--s.lc||s.off())}},notify(t,i){let n=!P.length;for(let a of r)P.push(a,s.value,t,i);if(n){for(C=0;C<P.length;C+=K)P[C](P[C+1],P[C+2],P[C+3]);P.length=0}},off(){},set(t){let i=s.value;i!==t&&(s.value=t,s.notify(i))},subscribe(t){let i=s.listen(t);return t(s.value),i},value:e};return s};const mt=5,X=6,Y=10;let vt=(e,r,s,t)=>(e.events=e.events||{},e.events[s+Y]||(e.events[s+Y]=t(i=>{e.events[s].reduceRight((n,a)=>(a(n),n),{shared:{},...i})})),e.events[s]=e.events[s]||[],e.events[s].push(r),()=>{let i=e.events[s],n=i.indexOf(r);i.splice(n,1),i.length||(delete e.events[s],e.events[s+Y](),delete e.events[s+Y])}),gt=1e3,pt=(e,r)=>vt(e,t=>{let i=r(t);i&&e.events[X].push(i)},mt,t=>{let i=e.listen;e.listen=(...a)=>(!e.lc&&!e.active&&(e.active=!0,t()),i(...a));let n=e.off;return e.events[X]=[],e.off=()=>{n(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let a of e.events[X])a();e.events[X]=[]}},gt)},()=>{e.listen=i,e.off=n}});var yt=Object.defineProperty,Mt=Object.defineProperties,bt=Object.getOwnPropertyDescriptors,Fe=Object.getOwnPropertySymbols,St=Object.prototype.hasOwnProperty,wt=Object.prototype.propertyIsEnumerable,_e=(e,r,s)=>r in e?yt(e,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[r]=s,R=(e,r)=>{for(var s in r||(r={}))St.call(r,s)&&_e(e,s,r[s]);if(Fe)for(var s of Fe(r))wt.call(r,s)&&_e(e,s,r[s]);return e},k=(e,r)=>Mt(e,bt(r)),Ft=class extends Error{constructor(e,r,s){super(r||e.toString(),{cause:s}),this.status=e,this.statusText=r,this.error=s}},_t=async(e,r)=>{var s,t,i,n,a,o;let d=r||{};const l={onRequest:[r==null?void 0:r.onRequest],onResponse:[r==null?void 0:r.onResponse],onSuccess:[r==null?void 0:r.onSuccess],onError:[r==null?void 0:r.onError],onRetry:[r==null?void 0:r.onRetry]};if(!r||!(r!=null&&r.plugins))return{url:e,options:d,hooks:l};for(const u of(r==null?void 0:r.plugins)||[]){if(u.init){const f=await((s=u.init)==null?void 0:s.call(u,e.toString(),r));d=f.options||d,e=f.url}l.onRequest.push((t=u.hooks)==null?void 0:t.onRequest),l.onResponse.push((i=u.hooks)==null?void 0:i.onResponse),l.onSuccess.push((n=u.hooks)==null?void 0:n.onSuccess),l.onError.push((a=u.hooks)==null?void 0:a.onError),l.onRetry.push((o=u.hooks)==null?void 0:o.onRetry)}return{url:e,options:d,hooks:l}},Ve=class{constructor(e){this.options=e}shouldAttemptRetry(e,r){return this.options.shouldRetry?Promise.resolve(e<this.options.attempts&&this.options.shouldRetry(r)):Promise.resolve(e<this.options.attempts)}getDelay(){return this.options.delay}},Vt=class{constructor(e){this.options=e}shouldAttemptRetry(e,r){return this.options.shouldRetry?Promise.resolve(e<this.options.attempts&&this.options.shouldRetry(r)):Promise.resolve(e<this.options.attempts)}getDelay(e){return Math.min(this.options.maxDelay,this.options.baseDelay*2**e)}};function Et(e){if(typeof e=="number")return new Ve({type:"linear",attempts:e,delay:1e3});switch(e.type){case"linear":return new Ve(e);case"exponential":return new Vt(e);default:throw new Error("Invalid retry strategy")}}var At=async e=>{const r={},s=async t=>typeof t=="function"?await t():t;if(e!=null&&e.auth){if(e.auth.type==="Bearer"){const t=await s(e.auth.token);if(!t)return r;r.authorization=`Bearer ${t}`}else if(e.auth.type==="Basic"){const t=s(e.auth.username),i=s(e.auth.password);if(!t||!i)return r;r.authorization=`Basic ${btoa(`${t}:${i}`)}`}else if(e.auth.type==="Custom"){const t=s(e.auth.value);if(!t)return r;r.authorization=`${s(e.auth.prefix)} ${t}`}}return r},Tt=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function Ot(e){const r=e.headers.get("content-type"),s=new Set(["image/svg","application/xml","application/xhtml","application/html"]);if(!r)return"json";const t=r.split(";").shift()||"";return Tt.test(t)?"json":s.has(t)||t.startsWith("text/")?"text":"blob"}function Pt(e){try{return JSON.parse(e),!0}catch{return!1}}function Ue(e){if(e===void 0)return!1;const r=typeof e;return r==="string"||r==="number"||r==="boolean"||r===null?!0:r!=="object"?!1:Array.isArray(e)?!0:e.buffer?!1:e.constructor&&e.constructor.name==="Object"||typeof e.toJSON=="function"}function Ee(e){try{return JSON.parse(e)}catch{return e}}function Ae(e){return typeof e=="function"}function Rt(e){if(e!=null&&e.customFetchImpl)return e.customFetchImpl;if(typeof globalThis<"u"&&Ae(globalThis.fetch))return globalThis.fetch;if(typeof window<"u"&&Ae(window.fetch))return window.fetch;throw new Error("No fetch implementation found")}async function It(e){const r=new Headers(e==null?void 0:e.headers),s=await At(e);for(const[t,i]of Object.entries(s||{}))r.set(t,i);if(!r.has("content-type")){const t=Lt(e==null?void 0:e.body);t&&r.set("content-type",t)}return r}function Lt(e){return Ue(e)?"application/json":null}function kt(e){if(!(e!=null&&e.body))return null;const r=new Headers(e==null?void 0:e.headers);if(Ue(e.body)&&!r.has("content-type")){for(const[s,t]of Object.entries(e==null?void 0:e.body))t instanceof Date&&(e.body[s]=t.toISOString());return JSON.stringify(e.body)}return e.body}function Dt(e,r){var s;if(r!=null&&r.method)return r.method.toUpperCase();if(e.startsWith("@")){const t=(s=e.split("@")[1])==null?void 0:s.split("/")[0];return Ce.includes(t)?t.toUpperCase():r!=null&&r.body?"POST":"GET"}return r!=null&&r.body?"POST":"GET"}function Ut(e,r){let s;return!(e!=null&&e.signal)&&(e!=null&&e.timeout)&&(s=setTimeout(()=>r==null?void 0:r.abort(),e==null?void 0:e.timeout)),{abortTimeout:s,clearTimeout:()=>{s&&clearTimeout(s)}}}var $t=class $e extends Error{constructor(r,s){super(s||JSON.stringify(r,null,2)),this.issues=r,Object.setPrototypeOf(this,$e.prototype)}};async function ee(e,r){let s=await e["~standard"].validate(r);if(s.issues)throw new $t(s.issues);return s.value}var Ce=["get","post","put","patch","delete"],Ct=e=>({id:"apply-schema",name:"Apply Schema",version:"1.0.0",async init(r,s){var t,i,n,a;const o=((i=(t=e.plugins)==null?void 0:t.find(d=>{var l;return(l=d.schema)!=null&&l.config?r.startsWith(d.schema.config.baseURL||"")||r.startsWith(d.schema.config.prefix||""):!1}))==null?void 0:i.schema)||e.schema;if(o){let d=r;(n=o.config)!=null&&n.prefix&&d.startsWith(o.config.prefix)&&(d=d.replace(o.config.prefix,""),o.config.baseURL&&(r=r.replace(o.config.prefix,o.config.baseURL))),(a=o.config)!=null&&a.baseURL&&d.startsWith(o.config.baseURL)&&(d=d.replace(o.config.baseURL,""));const l=o.schema[d];if(l){let u=k(R({},s),{method:l.method,output:l.output});return s!=null&&s.disableValidation||(u=k(R({},u),{body:l.input?await ee(l.input,s==null?void 0:s.body):s==null?void 0:s.body,params:l.params?await ee(l.params,s==null?void 0:s.params):s==null?void 0:s.params,query:l.query?await ee(l.query,s==null?void 0:s.query):s==null?void 0:s.query})),{url:r,options:u}}}return{url:r,options:s}}}),Bt=e=>{async function r(s,t){const i=k(R(R({},e),t),{plugins:[...(e==null?void 0:e.plugins)||[],Ct(e||{})]});if(e!=null&&e.catchAllError)try{return await fe(s,i)}catch(n){return{data:null,error:{status:500,statusText:"Fetch Error",message:"Fetch related error. Captured by catchAllError option. See error property for more details.",error:n}}}return await fe(s,i)}return r};function Nt(e,r){let{baseURL:s,params:t,query:i}=r||{query:{},params:{},baseURL:""},n=e.startsWith("http")?e.split("/").slice(0,3).join("/"):s||"";if(e.startsWith("@")){const f=e.toString().split("@")[1].split("/")[0];Ce.includes(f)&&(e=e.replace(`@${f}/`,"/"))}n.endsWith("/")||(n+="/");let[a,o]=e.replace(n,"").split("?");const d=new URLSearchParams(o);for(const[f,c]of Object.entries(i||{}))c!=null&&d.set(f,String(c));if(t)if(Array.isArray(t)){const f=a.split("/").filter(c=>c.startsWith(":"));for(const[c,v]of f.entries()){const h=t[c];a=a.replace(v,h)}}else for(const[f,c]of Object.entries(t))a=a.replace(`:${f}`,String(c));a=a.split("/").map(encodeURIComponent).join("/"),a.startsWith("/")&&(a=a.slice(1));let l=d.toString();return l=l.length>0?`?${l}`.replace(/\+/g,"%20"):"",n.startsWith("http")?new URL(`${a}${l}`,n):`${n}${a}${l}`}var fe=async(e,r)=>{var s,t,i,n,a,o,d,l;const{hooks:u,url:f,options:c}=await _t(e,r),v=Rt(c),h=new AbortController,p=(s=c.signal)!=null?s:h.signal,g=Nt(f,c),y=kt(c),m=await It(c),S=Dt(f,c);let M=k(R({},c),{url:g,headers:m,body:y,method:S,signal:p});for(const A of u.onRequest)if(A){const _=await A(M);_ instanceof Object&&(M=_)}("pipeTo"in M&&typeof M.pipeTo=="function"||typeof((t=r==null?void 0:r.body)==null?void 0:t.pipe)=="function")&&("duplex"in M||(M.duplex="half"));const{clearTimeout:V}=Ut(c,h);let b=await v(M.url,M);V();const E={response:b,request:M};for(const A of u.onResponse)if(A){const _=await A(k(R({},E),{response:(i=r==null?void 0:r.hookOptions)!=null&&i.cloneResponse?b.clone():b}));_ instanceof Response?b=_:_ instanceof Object&&(b=_.response)}if(b.ok){if(!(M.method!=="HEAD"))return{data:"",error:null};const _=Ot(b),T={data:"",response:b,request:M};if(_==="json"||_==="text"){const O=await b.text(),w=await((n=M.jsonParser)!=null?n:Ee)(O);T.data=w}else T.data=await b[_]();M!=null&&M.output&&M.output&&!M.disableValidation&&(T.data=await ee(M.output,T.data));for(const O of u.onSuccess)O&&await O(k(R({},T),{response:(a=r==null?void 0:r.hookOptions)!=null&&a.cloneResponse?b.clone():b}));return r!=null&&r.throw?T.data:{data:T.data,error:null}}const D=(o=r==null?void 0:r.jsonParser)!=null?o:Ee,F=await b.text(),$=Pt(F),U=$?await D(F):null,ie={response:b,responseText:F,request:M,error:k(R({},U),{status:b.status,statusText:b.statusText})};for(const A of u.onError)A&&await A(k(R({},ie),{response:(d=r==null?void 0:r.hookOptions)!=null&&d.cloneResponse?b.clone():b}));if(r!=null&&r.retry){const A=Et(r.retry),_=(l=r.retryAttempt)!=null?l:0;if(await A.shouldAttemptRetry(_,b)){for(const O of u.onRetry)O&&await O(E);const T=A.getDelay(_);return await new Promise(O=>setTimeout(O,T)),await fe(e,k(R({},r),{retryAttempt:_+1}))}}if(r!=null&&r.throw)throw new Ft(b.status,b.statusText,$?U:F);return{data:null,error:k(R({},U),{status:b.status,statusText:b.statusText})}},jt={},zt={};const te=Object.create(null),z=e=>{var r;return jt||((r=globalThis.Deno)==null?void 0:r.env.toObject())||globalThis.__env__||(e?te:globalThis)},B=new Proxy(te,{get(e,r){return z()[r]??te[r]},has(e,r){const s=z();return r in s||r in te},set(e,r,s){const t=z(!0);return t[r]=s,!0},deleteProperty(e,r){if(!r)return!1;const s=z(!0);return delete s[r],!0},ownKeys(){const e=z(!0);return Object.keys(e)}});function xt(e){return e?e!=="false":!1}const qt=typeof process<"u"&&zt&&"production"||"";qt==="test"||xt(B.TEST);const Wt=typeof window>"u",re=(e,r,s,t)=>{const i=q({data:null,error:null,isPending:!0,isRefetching:!1,refetch:()=>n()}),n=()=>{const o=typeof t=="function"?t({data:i.get().data,error:i.get().error,isPending:i.get().isPending}):t;return s(r,{...o,async onSuccess(d){var l;i.set({data:d.data,error:null,isPending:!1,isRefetching:!1,refetch:i.value.refetch}),await((l=o==null?void 0:o.onSuccess)==null?void 0:l.call(o,d))},async onError(d){var c,v;const{request:l}=d,u=typeof l.retry=="number"?l.retry:(c=l.retry)==null?void 0:c.attempts,f=l.retryAttempt||0;u&&f<u||(i.set({error:d.error,data:null,isPending:!1,isRefetching:!1,refetch:i.value.refetch}),await((v=o==null?void 0:o.onError)==null?void 0:v.call(o,d)))},async onRequest(d){var u;const l=i.get();i.set({isPending:l.data===null,data:l.data,error:null,isRefetching:!0,refetch:i.value.refetch}),await((u=o==null?void 0:o.onRequest)==null?void 0:u.call(o,d))}})};e=Array.isArray(e)?e:[e];let a=!1;for(const o of e)o.subscribe(()=>{Wt||(a?n():pt(i,()=>(setTimeout(()=>{n()},0),a=!0,()=>{i.off(),o.off()})))});return i};class Be extends Error{constructor(r,s){super(r),this.name="BetterAuthError",this.message=r,this.cause=s,this.stack=""}}function Ht(e){return{authorize(r,s="AND"){let t=!1;for(const[i,n]of Object.entries(r)){const a=e[i];if(!a)return{success:!1,error:`You are not allowed to access resource: ${i}`};if(Array.isArray(n))t=n.every(o=>a.includes(o));else if(typeof n=="object"){const o=n;o.connector==="OR"?t=o.actions.some(d=>a.includes(d)):t=o.actions.every(d=>a.includes(d))}else throw new Be("Invalid access control request");if(t&&s==="OR")return{success:t};if(!t&&s==="AND")return{success:!1,error:`unauthorized to access resource "${i}"`}}return t?{success:t}:{success:!1,error:"Not authorized"}},statements:e}}function Jt(e){return{newRole(r){return Ht(r)},statements:e}}const Gt={organization:["update","delete"],member:["create","update","delete"],invitation:["create","cancel"],team:["create","update","delete"]},pe=Jt(Gt),Ne=pe.newRole({organization:["update"],invitation:["create","cancel"],member:["create","update","delete"],team:["create","update","delete"]}),je=pe.newRole({organization:["update","delete"],member:["create","update","delete"],invitation:["create","cancel"],team:["create","update","delete"]}),ze=pe.newRole({organization:[],member:[],invitation:[],team:[]}),Qt={admin:Ne,owner:je,member:ze},Kt=e=>{if(!e.permissions&&!e.permission)return!1;const r=e.role.split(","),s=e.options.roles||Qt;for(const t of r){const i=s[t],n=i==null?void 0:i.authorize(e.permissions??e.permission);if(n!=null&&n.success)return!0}return!1},Xt=e=>{const r=q(!1),s=q(!1),t=q(!1),i={admin:Ne,member:ze,owner:je,...e==null?void 0:e.roles};return{id:"organization",$InferServerPlugin:{},getActions:n=>({$Infer:{ActiveOrganization:{},Organization:{},Invitation:{},Member:{},Team:{}},organization:{checkRolePermission:a=>Kt({role:a.role,options:{ac:e==null?void 0:e.ac,roles:i},permissions:a.permissions??a.permission})}}),getAtoms:n=>{const a=re(r,"/organization/list",n,{method:"GET"}),o=re([s],"/organization/get-full-organization",n,()=>({method:"GET"})),d=re([t],"/organization/get-active-member",n,{method:"GET"});return{$listOrg:r,$activeOrgSignal:s,$activeMemberSignal:t,activeOrganization:o,listOrganizations:a,activeMember:d}},pathMethods:{"/organization/get-full-organization":"GET"},atomListeners:[{matcher(n){return n==="/organization/create"||n==="/organization/delete"||n==="/organization/update"},signal:"$listOrg"},{matcher(n){return n.startsWith("/organization")},signal:"$activeOrgSignal"},{matcher(n){return n.startsWith("/organization/set-active")},signal:"$sessionSignal"},{matcher(n){return n.includes("/organization/update-member-role")},signal:"$activeMemberSignal"}]}},Yt=()=>({id:"better-auth-client",$InferServerPlugin:{}});function Zt(e){try{return new URL(e).pathname!=="/"}catch{throw new Be(`Invalid base URL: ${e}. Please provide a valid base URL.`)}}function ae(e,r="/api/auth"){return Zt(e)?e:(r=r.startsWith("/")?r:`/${r}`,`${e.replace(/\/+$/,"")}${r}`)}function er(e,r,s){if(e)return ae(e,r);const t=B.BETTER_AUTH_URL||B.NEXT_PUBLIC_BETTER_AUTH_URL||B.PUBLIC_BETTER_AUTH_URL||B.NUXT_PUBLIC_BETTER_AUTH_URL||B.NUXT_PUBLIC_AUTH_URL||(B.BASE_URL!=="/"?B.BASE_URL:void 0);if(t)return ae(t,r);if(typeof window<"u"&&window.location)return ae(window.location.origin,r)}const tr={proto:/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,constructor:/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,protoShort:/"__proto__"\s*:/,constructorShort:/"constructor"\s*:/},rr=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/,Te={true:!0,false:!1,null:null,undefined:void 0,nan:Number.NaN,infinity:Number.POSITIVE_INFINITY,"-infinity":Number.NEGATIVE_INFINITY},sr=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d{1,7}))?(?:Z|([+-])(\d{2}):(\d{2}))$/;function ir(e){return e instanceof Date&&!isNaN(e.getTime())}function nr(e){const r=sr.exec(e);if(!r)return null;const[,s,t,i,n,a,o,d,l,u,f]=r;let c=new Date(Date.UTC(parseInt(s,10),parseInt(t,10)-1,parseInt(i,10),parseInt(n,10),parseInt(a,10),parseInt(o,10),d?parseInt(d.padEnd(3,"0"),10):0));if(l){const v=(parseInt(u,10)*60+parseInt(f,10))*(l==="+"?-1:1);c.setUTCMinutes(c.getUTCMinutes()+v)}return ir(c)?c:null}function ar(e,r={}){const{strict:s=!1,warnings:t=!1,reviver:i,parseDates:n=!0}=r;if(typeof e!="string")return e;const a=e.trim();if(a[0]==='"'&&a.endsWith('"')&&!a.slice(1,-1).includes('"'))return a.slice(1,-1);const o=a.toLowerCase();if(o.length<=9&&o in Te)return Te[o];if(!rr.test(a)){if(s)throw new SyntaxError("[better-json] Invalid JSON");return e}if(Object.entries(tr).some(([l,u])=>{const f=u.test(a);return f&&t&&console.warn(`[better-json] Detected potential prototype pollution attempt using ${l} pattern`),f})&&s)throw new Error("[better-json] Potential prototype pollution attempt detected");try{return JSON.parse(a,(u,f)=>{if(u==="__proto__"||u==="constructor"&&f&&typeof f=="object"&&"prototype"in f){t&&console.warn(`[better-json] Dropping "${u}" key to prevent prototype pollution`);return}if(n&&typeof f=="string"){const c=nr(f);if(c)return c}return i?i(u,f):f})}catch(l){if(s)throw l;return e}}function or(e,r={strict:!0}){return ar(e,r)}const lr={id:"redirect",name:"Redirect",hooks:{onSuccess(e){var r,s;if((r=e.data)!=null&&r.url&&((s=e.data)!=null&&s.redirect)&&typeof window<"u"&&window.location&&window.location)try{window.location.href=e.data.url}catch{}}}};function ur(e){const r=q(!1);return{session:re(r,"/get-session",e,{method:"GET"}),$sessionSignal:r}}const cr=e=>{var v,h,p,g,y;const r="credentials"in Request.prototype,s=er(e==null?void 0:e.baseURL,e==null?void 0:e.basePath),t=((v=e==null?void 0:e.plugins)==null?void 0:v.flatMap(m=>m.fetchPlugins).filter(m=>m!==void 0))||[],i=Bt({baseURL:s,...r?{credentials:"include"}:{},method:"GET",jsonParser(m){return m?or(m,{strict:!1}):null},customFetchImpl:async(m,S)=>{try{return await fetch(m,S)}catch{return Response.error()}},...e==null?void 0:e.fetchOptions,plugins:e!=null&&e.disableDefaultFetchPlugins?[...((h=e==null?void 0:e.fetchOptions)==null?void 0:h.plugins)||[],...t]:[lr,...((p=e==null?void 0:e.fetchOptions)==null?void 0:p.plugins)||[],...t]}),{$sessionSignal:n,session:a}=ur(i),o=(e==null?void 0:e.plugins)||[];let d={},l={$sessionSignal:n,session:a},u={"/sign-out":"POST","/revoke-sessions":"POST","/revoke-other-sessions":"POST","/delete-user":"POST"};const f=[{signal:"$sessionSignal",matcher(m){return m==="/sign-out"||m==="/update-user"||m.startsWith("/sign-in")||m.startsWith("/sign-up")||m==="/delete-user"||m==="/verify-email"}}];for(const m of o)m.getAtoms&&Object.assign(l,(g=m.getAtoms)==null?void 0:g.call(m,i)),m.pathMethods&&Object.assign(u,m.pathMethods),m.atomListeners&&f.push(...m.atomListeners);const c={notify:m=>{l[m].set(!l[m].get())},listen:(m,S)=>{l[m].subscribe(S)},atoms:l};for(const m of o)m.getActions&&Object.assign(d,(y=m.getActions)==null?void 0:y.call(m,i,c,e));return{pluginsActions:d,pluginsAtoms:l,pluginPathMethods:u,atomListeners:f,$fetch:i,$store:c}};function dr(e,r,s){const t=r[e],{fetchOptions:i,query:n,...a}=s||{};return t||(i!=null&&i.method?i.method:a&&Object.keys(a).length>0?"POST":"GET")}function fr(e,r,s,t,i){function n(a=[]){return new Proxy(function(){},{get(o,d){const l=[...a,d];let u=e;for(const f of l)if(u&&typeof u=="object"&&f in u)u=u[f];else{u=void 0;break}return typeof u=="function"?u:n(l)},apply:async(o,d,l)=>{const u="/"+a.map(m=>m.replace(/[A-Z]/g,S=>`-${S.toLowerCase()}`)).join("/"),f=l[0]||{},c=l[1]||{},{query:v,fetchOptions:h,...p}=f,g={...c,...h},y=dr(u,s,f);return await r(u,{...g,body:y==="GET"?void 0:{...p,...(g==null?void 0:g.body)||{}},query:v||(g==null?void 0:g.query),method:y,async onSuccess(m){var b;await((b=g==null?void 0:g.onSuccess)==null?void 0:b.call(g,m));const S=i==null?void 0:i.find(E=>E.matcher(u));if(!S)return;const M=t[S.signal];if(!M)return;const V=M.get();setTimeout(()=>{M.set(!V)},10)}})}})}return n()}function hr(e){return e.charAt(0).toUpperCase()+e.slice(1)}function mr(e){const r=e.listen(()=>{}),[s,t]=Ze({value:e.get()}),i=e.subscribe(n=>{t("value",et(n))});return me(()=>i()),r(),()=>s.value}function vr(e){return`use${hr(e)}`}function gr(e){const{pluginPathMethods:r,pluginsActions:s,pluginsAtoms:t,$fetch:i,atomListeners:n}=cr(e);let a={};for(const[l,u]of Object.entries(t))a[vr(l)]=()=>mr(u);const o={...s,...a};return fr(o,i,r,t,n)}var pr={};const yr=gr({baseURL:pr.BETTER_AUTH_URL,plugins:[Yt(),Xt({})]}),{signIn:wr,signOut:Fr,signUp:_r,getAccessToken:Vr,useSession:Er,token:Ar,organization:Tr}=yr;export{Ie as S,wr as a,rt as b,Sr as c,Tr as o,_r as s};

import{m as x,b as N,d as Se,P as k,x as Ve,_ as Ee,l as qe,j as we,h as Y}from"./cn-D_CxhGnA.js";import{n as Ae,h as Ie,j as K,l as ze,B as F,u as _e,k as $,o as P,c as E,e as A,s as T,m as Ce,f as ee,D as Oe,S as Ne,Z as O,$ as Ue,a0 as se,E as Te,J as xe,a1 as pe}from"./main-CmErNaLo.js";var He=["id","name","validationState","required","disabled","readOnly"];function Ge(i){const s=`form-control-${Ie()}`,r=x({id:s},i),[e,t]=K(),[a,o]=K(),[n,d]=K(),[f,c]=K(),u=(m,p,g)=>{const M=g!=null||e()!=null;return[g,e(),M&&p!=null?m:void 0].filter(Boolean).join(" ")||void 0},l=m=>[n(),f(),m].filter(Boolean).join(" ")||void 0,v=ze(()=>({"data-valid":F(r.validationState)==="valid"?"":void 0,"data-invalid":F(r.validationState)==="invalid"?"":void 0,"data-required":F(r.required)?"":void 0,"data-disabled":F(r.disabled)?"":void 0,"data-readonly":F(r.readOnly)?"":void 0}));return{formControlContext:{name:()=>F(r.name)??F(r.id),dataset:v,validationState:()=>F(r.validationState),isRequired:()=>F(r.required),isDisabled:()=>F(r.disabled),isReadOnly:()=>F(r.readOnly),labelId:e,fieldId:a,descriptionId:n,errorMessageId:f,getAriaLabelledBy:u,getAriaDescribedBy:l,generateId:Se(()=>F(r.id)),registerLabel:N(t),registerField:N(o),registerDescription:N(d),registerErrorMessage:N(c)}}}var De=Ae();function q(){const i=_e(De);if(i===void 0)throw new Error("[kobalte]: `useFormControlContext` must be used within a `FormControlContext.Provider` component");return i}function Pe(i){const s=q(),r=x({id:s.generateId("description")},i);return $(()=>P(s.registerDescription(r.id))),E(k,A({as:"div"},()=>s.dataset(),r))}var Je=["id","aria-label","aria-labelledby","aria-describedby"];function Ze(i){const s=q(),r=x({id:s.generateId("field")},i);return $(()=>P(s.registerField(F(r.id)))),{fieldProps:{id:()=>F(r.id),ariaLabel:()=>F(r["aria-label"]),ariaLabelledBy:()=>s.getAriaLabelledBy(F(r.id),F(r["aria-label"]),F(r["aria-labelledby"])),ariaDescribedBy:()=>s.getAriaDescribedBy(F(r["aria-describedby"]))}}}function ue(i){let s;const r=q(),e=x({id:r.generateId("label")},i),[t,a]=T(e,["ref"]),o=Ve(()=>s,()=>"label");return $(()=>P(r.registerLabel(a.id))),E(k,A({as:"label",ref(n){var d=ee(f=>s=f,t.ref);typeof d=="function"&&d(n)},get for(){return Ce(()=>o()==="label")()?r.fieldId():void 0}},()=>r.dataset(),a))}function Qe(i,s){$(Oe(i,r=>{if(r==null)return;const e=Xe(r);e!=null&&(e.addEventListener("reset",s,{passive:!0}),P(()=>{e.removeEventListener("reset",s)}))}))}function Xe(i){return Ye(i)?i.form:i.closest("form")}function Ye(i){return i.matches("textarea, input, select, button")}function de(i){const s=q(),r=x({id:s.generateId("error-message")},i),[e,t]=T(r,["forceMount"]),a=()=>s.validationState()==="invalid";return $(()=>{a()&&P(s.registerErrorMessage(t.id))}),E(Ne,{get when(){return e.forceMount||a()},get children(){return E(k,A({as:"div"},()=>s.dataset(),t))}})}var et={};Ee(et,{Root:()=>Be,Separator:()=>tt});function Be(i){let s;const r=x({orientation:"horizontal"},i),[e,t]=T(r,["ref","orientation"]),a=Ve(()=>s,()=>"hr");return E(k,A({as:"hr",ref(o){var n=ee(d=>s=d,e.ref);typeof n=="function"&&n(o)},get role(){return a()!=="hr"?"separator":void 0},get"aria-orientation"(){return e.orientation==="vertical"?"vertical":void 0},get"data-orientation"(){return e.orientation}},t))}var tt=Be,rt={};Ee(rt,{Description:()=>Pe,ErrorMessage:()=>de,Input:()=>fe,Label:()=>ue,Root:()=>he,TextArea:()=>$e,TextField:()=>st,useTextFieldContext:()=>ce});var Le=Ae();function ce(){const i=_e(Le);if(i===void 0)throw new Error("[kobalte]: `useTextFieldContext` must be used within a `TextField` component");return i}function fe(i){return E(ke,A({type:"text"},i))}function ke(i){const s=q(),r=ce(),e=x({id:r.generateId("input")},i),[t,a,o]=T(e,["onInput"],Je),{fieldProps:n}=Ze(a);return E(k,A({as:"input",get id(){return n.id()},get name(){return s.name()},get value(){return r.value()},get required(){return s.isRequired()},get disabled(){return s.isDisabled()},get readonly(){return s.isReadOnly()},get"aria-label"(){return n.ariaLabel()},get"aria-labelledby"(){return n.ariaLabelledBy()},get"aria-describedby"(){return n.ariaDescribedBy()},get"aria-invalid"(){return s.validationState()==="invalid"||void 0},get"aria-required"(){return s.isRequired()||void 0},get"aria-disabled"(){return s.isDisabled()||void 0},get"aria-readonly"(){return s.isReadOnly()||void 0},get onInput(){return we([t.onInput,r.onInput])}},()=>s.dataset(),o))}function he(i){let s;const r=`textfield-${Ie()}`,e=x({id:r},i),[t,a,o]=T(e,["ref","value","defaultValue","onChange"],He),n=t.value,[d,f]=qe({value:()=>n===void 0?void 0:t.value??"",defaultValue:()=>t.defaultValue,onChange:v=>{var h;return(h=t.onChange)==null?void 0:h.call(t,v)}}),{formControlContext:c}=Ge(a);Qe(()=>s,()=>f(t.defaultValue??""));const u=v=>{if(c.isReadOnly()||c.isDisabled())return;const h=v.target;f(h.value),h.value=d()??""},l={value:d,generateId:Se(()=>F(a.id)),onInput:u};return E(De.Provider,{value:c,get children(){return E(Le.Provider,{value:l,get children(){return E(k,A({as:"div",ref(v){var h=ee(m=>s=m,t.ref);typeof h=="function"&&h(v)},role:"group",get id(){return F(a.id)}},()=>c.dataset(),o))}})}})}function $e(i){let s;const r=ce(),e=x({id:r.generateId("textarea")},i),[t,a]=T(e,["ref","autoResize","submitOnEnter","onKeyPress"]);$(Oe([()=>s,()=>t.autoResize,()=>r.value()],([n,d])=>{!n||!d||it(n)}));const o=n=>{s&&t.submitOnEnter&&n.key==="Enter"&&!n.shiftKey&&s.form&&(s.form.requestSubmit(),n.preventDefault())};return E(ke,A({as:"textarea",get"aria-multiline"(){return t.submitOnEnter?"false":void 0},get onKeyPress(){return we([t.onKeyPress,o])},ref(n){var d=ee(f=>s=f,t.ref);typeof d=="function"&&d(n)}},a))}function it(i){const s=i.style.alignSelf,r=i.style.overflow;"MozAppearance"in i.style||(i.style.overflow="hidden"),i.style.alignSelf="start",i.style.height="auto",i.style.height=`${i.scrollHeight+(i.offsetHeight-i.clientHeight)}px`,i.style.overflow=r,i.style.alignSelf=s}var st=Object.assign(he,{Description:Pe,ErrorMessage:de,Input:fe,Label:ue,TextArea:$e});const bt=i=>{const[s,r]=T(i,["class"]);return E(he,A({get class(){return Y("flex flex-col gap-1",s.class)}},r))},yt=i=>{const s=A({type:"text"},i),[r,e]=T(s,["type","class"]);return E(fe,A({get type(){return r.type},get class(){return Y("flex h-9 w-full min-w-0 appearance-none rounded-md border-0 border-input bg-secondary/70 px-3 py-1 text-base shadow-xs outline-none transition-[color,box-shadow] selection:bg-primary selection:text-primary-foreground file:inline-flex file:h-7 file:border-0 file:bg-transparent file:font-medium file:text-foreground file:text-sm placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-[1px] focus-visible:ring-ring/50 disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm ",r.class)}},e))},Ft=i=>{const[s,r]=T(i,["class"]);return E(ue,A({get class(){return Y("w-fit font-normal text-muted-foreground",s.class)}},r))},St=i=>{const[s,r]=T(i,["class","error"]);return E(de,A({get class(){return Y(" text-destructive text-xs data-[invalid]:text-destructive",s.class)}},r,{get children(){return s.error}}))};function ve(i,s){return typeof i=="function"?i(s):i}function W(i,s){return me(s).reduce((e,t)=>{if(e===null)return null;if(typeof e<"u")return e[t]},i)}function U(i,s,r){const e=me(s);function t(a){if(!e.length)return ve(r,a);const o=e.shift();if(typeof o=="string"||typeof o=="number"&&!Array.isArray(a))return typeof a=="object"?(a===null&&(a={}),{...a,[o]:t(a[o])}):{[o]:t()};if(Array.isArray(a)&&typeof o=="number"){const n=a.slice(0,o);return[...n.length?n:new Array(o),t(a[o]),...a.slice(o+1)]}return[...new Array(o),t()]}return t(i)}function at(i,s){const r=me(s);function e(t){if(!t)return;if(r.length===1){const o=r[0];if(Array.isArray(t)&&typeof o=="number")return t.filter((f,c)=>c!==o);const{[o]:n,...d}=t;return d}const a=r.shift();if(typeof a=="string"&&typeof t=="object")return{...t,[a]:e(t[a])};if(typeof a=="number"&&Array.isArray(t)){if(a>=t.length)return t;const o=t.slice(0,a);return[...o.length?o:new Array(a),e(t[a]),...t.slice(a+1)]}throw new Error("It seems we have created an infinite loop in deleteBy. ")}return e(i)}const ot=/^(\d+)$/gm,nt=/\.(\d+)(?=\.)/gm,lt=/^(\d+)\./gm,ut=/\.(\d+$)/gm,dt=/\.{2,}/gm,ae="__int__",H=`${ae}$1`;function me(i){if(Array.isArray(i))return[...i];if(typeof i!="string")throw new Error("Path must be a string.");return i.replace(/(^\[)|]/gm,"").replace(/\[/g,".").replace(ot,H).replace(nt,`.${H}.`).replace(lt,`${H}.`).replace(ut,`.${H}`).replace(dt,".").split(".").map(s=>s.indexOf(ae)===0?parseInt(s.substring(ae.length),10):s)}function ct(i){return!(Array.isArray(i)&&i.length===0)}function oe(i,s){const{asyncDebounceMs:r}=s,{onChangeAsync:e,onBlurAsync:t,onSubmitAsync:a,onBlurAsyncDebounceMs:o,onChangeAsyncDebounceMs:n}=s.validators||{},d=r??0,f={cause:"change",validate:e,debounceMs:n??d},c={cause:"blur",validate:t,debounceMs:o??d},u={cause:"submit",validate:a,debounceMs:0},l=v=>({...v,debounceMs:0});switch(i){case"submit":return[l(f),l(c),u];case"blur":return[c];case"change":return[f];case"server":default:return[]}}function ne(i,s){const{onChange:r,onBlur:e,onSubmit:t,onMount:a}=s.validators||{},o={cause:"change",validate:r},n={cause:"blur",validate:e},d={cause:"submit",validate:t},f={cause:"mount",validate:a},c={cause:"server",validate:()=>{}};switch(i){case"mount":return[f];case"submit":return[o,n,d,c];case"server":return[c];case"blur":return[n,c];case"change":default:return[o,c]}}const le=i=>!!i&&typeof i=="object"&&"fields"in i;function B(i,s){if(Object.is(i,s))return!0;if(typeof i!="object"||i===null||typeof s!="object"||s===null)return!1;if(i instanceof Map&&s instanceof Map){if(i.size!==s.size)return!1;for(const[t,a]of i)if(!s.has(t)||!Object.is(a,s.get(t)))return!1;return!0}if(i instanceof Set&&s instanceof Set){if(i.size!==s.size)return!1;for(const t of i)if(!s.has(t))return!1;return!0}const r=Object.keys(i),e=Object.keys(s);if(r.length!==e.length)return!1;for(const t of r)if(!e.includes(t)||!B(i[t],s[t]))return!1;return!0}const Me=({newFormValidatorError:i,isPreviousErrorFromFormValidator:s,previousErrorValue:r})=>i?{newErrorValue:i,newSource:"form"}:s?{newErrorValue:void 0,newSource:void 0}:r?{newErrorValue:r,newSource:"field"}:{newErrorValue:void 0,newSource:void 0},be=({formLevelError:i,fieldLevelError:s})=>s?{newErrorValue:s,newSource:"field"}:i?{newErrorValue:i,newSource:"form"}:{newErrorValue:void 0,newSource:void 0};function ft(i){const s=new Map;for(const r of i){const e=[...r.path??[]].map(t=>{const a=typeof t=="object"?t.key:t;return typeof a=="number"?`[${a}]`:a}).join(".").replace(/\.\[/g,"[");s.set(e,(s.get(e)??[]).concat(r))}return Object.fromEntries(s)}const ye=i=>{const s=ft(i);return{form:s,fields:s}},L={validate({value:i,validationSource:s},r){const e=r["~standard"].validate(i);if(e instanceof Promise)throw new Error("async function passed to sync validator");if(e.issues)return s==="field"?e.issues:ye(e.issues)},async validateAsync({value:i,validationSource:s},r){const e=await r["~standard"].validate(i);if(e.issues)return s==="field"?e.issues:ye(e.issues)}},Re=i=>!!i&&"~standard"in i,X={isValidating:!1,isTouched:!1,isBlurred:!1,isDirty:!1,isPristine:!0,isValid:!0,isDefaultValue:!0,errors:[],errorMap:{},errorSourceMap:{}};function G(i){function s(u,l,v,h){const m=e(u,l,v,h);({insert:()=>n(m,u,l),remove:()=>d(m),swap:()=>h!==void 0&&c(m,u,l,h),move:()=>h!==void 0&&f(m,u,l,h)})[v]()}function r(u,l){return`${u}[${l}]`}function e(u,l,v,h){const m=[r(u,l)];if(v==="swap")m.push(r(u,h));else if(v==="move"){const[p,g]=[Math.min(l,h),Math.max(l,h)];for(let M=p;M<=g;M++)m.push(r(u,M))}else{const p=i.getFieldValue(u),g=Array.isArray(p)?p.length:0;for(let M=l+1;M<g;M++)m.push(r(u,M))}return Object.keys(i.fieldInfo).filter(p=>m.some(g=>p.startsWith(g)))}function t(u,l){return u.replace(/\[(\d+)\]/,(v,h)=>{const m=parseInt(h,10);return`[${l==="up"?m+1:Math.max(0,m-1)}]`})}function a(u,l){(l==="up"?u:[...u].reverse()).forEach(h=>{const m=t(h.toString(),l),p=i.getFieldMeta(m);p?i.setFieldMeta(h,p):i.setFieldMeta(h,o())})}const o=()=>X,n=(u,l,v)=>{a(u,"down"),u.forEach(h=>{h.toString().startsWith(r(l,v))&&i.setFieldMeta(h,o())})},d=u=>{a(u,"up")},f=(u,l,v,h)=>{const m=new Map(Object.keys(i.fieldInfo).filter(p=>p.startsWith(r(l,v))).map(p=>[p,i.getFieldMeta(p)]));a(u,v<h?"up":"down"),Object.keys(i.fieldInfo).filter(p=>p.startsWith(r(l,h))).forEach(p=>{const g=p.replace(r(l,h),r(l,v)),M=m.get(g);M&&i.setFieldMeta(p,M)})},c=(u,l,v,h)=>{u.forEach(m=>{if(!m.toString().startsWith(r(l,v)))return;const p=m.toString().replace(r(l,v),r(l,h)),[g,M]=[i.getFieldMeta(m),i.getFieldMeta(p)];g&&i.setFieldMeta(p,g),M&&i.setFieldMeta(m,M)})};return{handleArrayFieldMetaShift:s}}function ie(i){return{values:i.values??{},errorMap:i.errorMap??{},fieldMetaBase:i.fieldMetaBase??{},isSubmitted:i.isSubmitted??!1,isSubmitting:i.isSubmitting??!1,isValidating:i.isValidating??!1,submissionAttempts:i.submissionAttempts??0,isSubmitSuccessful:i.isSubmitSuccessful??!1,validationMetaMap:i.validationMetaMap??{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0}}}class ht{constructor(s){var r;this.options={},this.fieldInfo={},this.prevTransformArray=[],this.mount=()=>{var e,t;const a=this.fieldMetaDerived.mount(),o=this.store.mount(),n=()=>{a(),o()};(t=(e=this.options.listeners)==null?void 0:e.onMount)==null||t.call(e,{formApi:this});const{onMount:d}=this.options.validators||{};return d&&this.validateSync("mount"),n},this.update=e=>{var t,a;if(!e)return;const o=this.options;this.options=e;const n=!!((a=(t=e.transform)==null?void 0:t.deps)!=null&&a.some((c,u)=>c!==this.prevTransformArray[u])),d=e.defaultValues&&!B(e.defaultValues,o.defaultValues)&&!this.state.isTouched,f=!B(e.defaultState,o.defaultState)&&!this.state.isTouched;!d&&!f&&!n||O(()=>{this.baseStore.setState(()=>ie(Object.assign({},this.state,f?e.defaultState:{},d?{values:e.defaultValues}:{},n?{_force_re_eval:!this.state._force_re_eval}:{})))})},this.reset=(e,t)=>{const{fieldMeta:a}=this.state,o=this.resetFieldMeta(a);e&&!(t!=null&&t.keepDefaultValues)&&(this.options={...this.options,defaultValues:e}),this.baseStore.setState(()=>{var n;return ie({...this.options.defaultState,values:e??this.options.defaultValues??((n=this.options.defaultState)==null?void 0:n.values),fieldMetaBase:o})})},this.validateAllFields=async e=>{const t=[];return O(()=>{Object.values(this.fieldInfo).forEach(o=>{if(!o.instance)return;const n=o.instance;t.push(Promise.resolve().then(()=>n.validate(e,{skipFormValidation:!0}))),o.instance.state.meta.isTouched||o.instance.setMeta(d=>({...d,isTouched:!0}))})}),(await Promise.all(t)).flat()},this.validateArrayFieldsStartingFrom=async(e,t,a)=>{const o=this.getFieldValue(e),n=Array.isArray(o)?Math.max(o.length-1,0):null,d=[`${e}[${t}]`];for(let l=t+1;l<=(n??0);l++)d.push(`${e}[${l}]`);const f=Object.keys(this.fieldInfo).filter(l=>d.some(v=>l.startsWith(v))),c=[];return O(()=>{f.forEach(l=>{c.push(Promise.resolve().then(()=>this.validateField(l,a)))})}),(await Promise.all(c)).flat()},this.validateField=(e,t)=>{var a;const o=(a=this.fieldInfo[e])==null?void 0:a.instance;return o?(o.state.meta.isTouched||o.setMeta(n=>({...n,isTouched:!0})),o.validate(t)):[]},this.validateSync=e=>{const t=ne(e,this.options);let a=!1;const o={};return O(()=>{var n,d;for(const c of t){if(!c.validate)continue;const u=this.runValidator({validate:c.validate,value:{value:this.state.values,formApi:this,validationSource:"form"},type:"validate"}),{formError:l,fieldErrors:v}=Q(u),h=J(c.cause);for(const m of Object.keys(this.state.fieldMeta)){const p=this.getFieldMeta(m);if(!p)continue;const{errorMap:g,errorSourceMap:M}=p,y=v==null?void 0:v[m],{newErrorValue:V,newSource:w}=Me({newFormValidatorError:y,isPreviousErrorFromFormValidator:(M==null?void 0:M[h])==="form",previousErrorValue:g==null?void 0:g[h]});w==="form"&&(o[m]={...o[m],[h]:y}),(g==null?void 0:g[h])!==V&&this.setFieldMeta(m,I=>({...I,errorMap:{...I.errorMap,[h]:V},errorSourceMap:{...I.errorSourceMap,[h]:w}}))}((n=this.state.errorMap)==null?void 0:n[h])!==l&&this.baseStore.setState(m=>({...m,errorMap:{...m.errorMap,[h]:l}})),(l||v)&&(a=!0)}const f=J("submit");(d=this.state.errorMap)!=null&&d[f]&&e!=="submit"&&!a&&this.baseStore.setState(c=>({...c,errorMap:{...c.errorMap,[f]:void 0}}))}),{hasErrored:a,fieldsErrorMap:o}},this.validateAsync=async e=>{const t=oe(e,this.options);this.state.isFormValidating||this.baseStore.setState(f=>({...f,isFormValidating:!0}));const a=[];let o;for(const f of t){if(!f.validate)continue;const c=J(f.cause),u=this.state.validationMetaMap[c];u==null||u.lastAbortController.abort();const l=new AbortController;this.state.validationMetaMap[c]={lastAbortController:l},a.push(new Promise(async v=>{let h;try{h=await new Promise((M,y)=>{setTimeout(async()=>{if(l.signal.aborted)return M(void 0);try{M(await this.runValidator({validate:f.validate,value:{value:this.state.values,formApi:this,validationSource:"form",signal:l.signal},type:"validateAsync"}))}catch(V){y(V)}},f.debounceMs)})}catch(M){h=M}const{formError:m,fieldErrors:p}=Q(h);p&&(o=o?{...o,...p}:p);const g=J(f.cause);for(const M of Object.keys(this.state.fieldMeta)){const y=this.getFieldMeta(M);if(!y)continue;const{errorMap:V,errorSourceMap:w}=y,I=o==null?void 0:o[M],{newErrorValue:_,newSource:D}=Me({newFormValidatorError:I,isPreviousErrorFromFormValidator:(w==null?void 0:w[g])==="form",previousErrorValue:V==null?void 0:V[g]});(V==null?void 0:V[g])!==_&&this.setFieldMeta(M,S=>({...S,errorMap:{...S.errorMap,[g]:_},errorSourceMap:{...S.errorSourceMap,[g]:D}}))}this.baseStore.setState(M=>({...M,errorMap:{...M.errorMap,[g]:m}})),v(o?{fieldErrors:o,errorMapKey:g}:void 0)}))}let n=[];const d={};if(a.length){n=await Promise.all(a);for(const f of n)if(f!=null&&f.fieldErrors){const{errorMapKey:c}=f;for(const[u,l]of Object.entries(f.fieldErrors)){const h={...d[u]||{},[c]:l};d[u]=h}}}return this.baseStore.setState(f=>({...f,isFormValidating:!1})),d},this.validate=e=>{const{hasErrored:t,fieldsErrorMap:a}=this.validateSync(e);return t&&!this.options.asyncAlways?a:this.validateAsync(e)},this.getFieldValue=e=>W(this.state.values,e),this.getFieldMeta=e=>this.state.fieldMeta[e],this.getFieldInfo=e=>{var t;return(t=this.fieldInfo)[e]||(t[e]={instance:null,validationMetaMap:{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0}})},this.setFieldMeta=(e,t)=>{this.baseStore.setState(a=>({...a,fieldMetaBase:{...a.fieldMetaBase,[e]:ve(t,a.fieldMetaBase[e])}}))},this.resetFieldMeta=e=>Object.keys(e).reduce((t,a)=>{const o=a;return t[o]=X,t},{}),this.setFieldValue=(e,t,a)=>{const o=(a==null?void 0:a.dontUpdateMeta)??!1;O(()=>{o||this.setFieldMeta(e,n=>({...n,isTouched:!0,isDirty:!0,errorMap:{...n==null?void 0:n.errorMap,onMount:void 0}})),this.baseStore.setState(n=>({...n,values:U(n.values,e,t)}))})},this.deleteField=e=>{const a=[...Object.keys(this.fieldInfo).filter(o=>{const n=e.toString();return o!==n&&o.startsWith(n)}),e];this.baseStore.setState(o=>{const n={...o};return a.forEach(d=>{n.values=at(n.values,d),delete this.fieldInfo[d],delete n.fieldMetaBase[d]}),n})},this.pushFieldValue=(e,t,a)=>{this.setFieldValue(e,o=>[...Array.isArray(o)?o:[],t],a),this.validateField(e,"change")},this.insertFieldValue=async(e,t,a,o)=>{this.setFieldValue(e,n=>[...n.slice(0,t),a,...n.slice(t)],o),await this.validateField(e,"change"),G(this).handleArrayFieldMetaShift(e,t,"insert"),await this.validateArrayFieldsStartingFrom(e,t,"change")},this.replaceFieldValue=async(e,t,a,o)=>{this.setFieldValue(e,n=>n.map((d,f)=>f===t?a:d),o),await this.validateField(e,"change"),await this.validateArrayFieldsStartingFrom(e,t,"change")},this.removeFieldValue=async(e,t,a)=>{const o=this.getFieldValue(e),n=Array.isArray(o)?Math.max(o.length-1,0):null;if(this.setFieldValue(e,d=>d.filter((f,c)=>c!==t),a),G(this).handleArrayFieldMetaShift(e,t,"remove"),n!==null){const d=`${e}[${n}]`;this.deleteField(d)}await this.validateField(e,"change"),await this.validateArrayFieldsStartingFrom(e,t,"change")},this.swapFieldValues=(e,t,a,o)=>{this.setFieldValue(e,n=>{const d=n[t],f=n[a];return U(U(n,`${t}`,f),`${a}`,d)},o),G(this).handleArrayFieldMetaShift(e,t,"swap",a),this.validateField(e,"change"),this.validateField(`${e}[${t}]`,"change"),this.validateField(`${e}[${a}]`,"change")},this.moveFieldValues=(e,t,a,o)=>{this.setFieldValue(e,n=>{const d=[...n];return d.splice(a,0,d.splice(t,1)[0]),d},o),G(this).handleArrayFieldMetaShift(e,t,"move",a),this.validateField(e,"change"),this.validateField(`${e}[${t}]`,"change"),this.validateField(`${e}[${a}]`,"change")},this.clearFieldValues=(e,t)=>{const a=this.getFieldValue(e),o=Array.isArray(a)?Math.max(a.length-1,0):null;if(this.setFieldValue(e,[],t),o!==null)for(let n=0;n<=o;n++){const d=`${e}[${n}]`;this.deleteField(d)}this.validateField(e,"change")},this.resetField=e=>{this.baseStore.setState(t=>({...t,fieldMetaBase:{...t.fieldMetaBase,[e]:X},values:this.options.defaultValues?U(t.values,e,W(this.options.defaultValues,e)):t.values}))},this.getAllErrors=()=>({form:{errors:this.state.errors,errorMap:this.state.errorMap},fields:Object.entries(this.state.fieldMeta).reduce((e,[t,a])=>(Object.keys(a).length&&a.errors.length&&(e[t]={errors:a.errors,errorMap:a.errorMap}),e),{})}),this.parseValuesWithSchema=e=>L.validate({value:this.state.values,validationSource:"form"},e),this.parseValuesWithSchemaAsync=e=>L.validateAsync({value:this.state.values,validationSource:"form"},e),this.baseStore=new Ue(ie({...s==null?void 0:s.defaultState,values:(s==null?void 0:s.defaultValues)??((r=s==null?void 0:s.defaultState)==null?void 0:r.values)})),this.fieldMetaDerived=new se({deps:[this.baseStore],fn:({prevDepVals:e,currDepVals:t,prevVal:a})=>{var o,n,d;const f=a,c=e==null?void 0:e[0],u=t[0];let l=0;const v={};for(const h of Object.keys(u.fieldMetaBase)){const m=u.fieldMetaBase[h],p=c==null?void 0:c.fieldMetaBase[h],g=f==null?void 0:f[h],M=W(u.values,h);let y=g==null?void 0:g.errors;if(!p||m.errorMap!==p.errorMap){y=Object.values(m.errorMap??{}).filter(D=>D!==void 0);const _=(o=this.getFieldInfo(h))==null?void 0:o.instance;_&&!_.options.disableErrorFlat&&(y=y==null?void 0:y.flat(1))}const V=!ct(y??[]),w=!m.isDirty,I=B(M,W(this.options.defaultValues,h))||B(M,(d=(n=this.getFieldInfo(h))==null?void 0:n.instance)==null?void 0:d.options.defaultValue);if(g&&g.isPristine===w&&g.isValid===V&&g.isDefaultValue===I&&g.errors===y&&m===p){v[h]=g,l++;continue}v[h]={...m,errors:y,isPristine:w,isValid:V,isDefaultValue:I}}return Object.keys(u.fieldMetaBase).length&&f&&l===Object.keys(u.fieldMetaBase).length?f:v}}),this.store=new se({deps:[this.baseStore,this.fieldMetaDerived],fn:({prevDepVals:e,currDepVals:t,prevVal:a})=>{var o,n,d,f;const c=a,u=e==null?void 0:e[0],l=t[0],v=t[1],h=Object.values(v).filter(Boolean),m=h.some(b=>b.isValidating),p=h.every(b=>b.isValid),g=h.some(b=>b.isTouched),M=h.some(b=>b.isBlurred),y=h.every(b=>b.isDefaultValue),V=g&&((o=l.errorMap)==null?void 0:o.onMount),w=h.some(b=>b.isDirty),I=!w,_=!!((n=l.errorMap)!=null&&n.onMount||h.some(b=>{var C;return(C=b==null?void 0:b.errorMap)==null?void 0:C.onMount})),D=!!m;let S=(c==null?void 0:c.errors)??[];(!u||l.errorMap!==u.errorMap)&&(S=Object.values(l.errorMap).reduce((b,C)=>C===void 0?b:C&&le(C)?(b.push(C.form),b):(b.push(C),b),[]));const R=S.length===0,j=p&&R,We=this.options.canSubmitWhenInvalid??!1,ge=l.submissionAttempts===0&&!g&&!_||!D&&!l.isSubmitting&&j||We;let z=l.errorMap;if(V&&(S=S.filter(b=>b!==l.errorMap.onMount),z=Object.assign(z,{onMount:void 0})),c&&u&&c.errorMap===z&&c.fieldMeta===this.fieldMetaDerived.state&&c.errors===S&&c.isFieldsValidating===m&&c.isFieldsValid===p&&c.isFormValid===R&&c.isValid===j&&c.canSubmit===ge&&c.isTouched===g&&c.isBlurred===M&&c.isPristine===I&&c.isDefaultValue===y&&c.isDirty===w&&B(u,l))return c;let te={...l,errorMap:z,fieldMeta:this.fieldMetaDerived.state,errors:S,isFieldsValidating:m,isFieldsValid:p,isFormValid:R,isValid:j,canSubmit:ge,isTouched:g,isBlurred:M,isPristine:I,isDefaultValue:y,isDirty:w};const re=((d=this.options.transform)==null?void 0:d.deps)??[];if(re.length!==this.prevTransformArray.length||re.some((b,C)=>b!==this.prevTransformArray[C])){const b=Object.assign({},this,{state:te});(f=this.options.transform)==null||f.fn(b),te=b.state,this.prevTransformArray=re}return te}}),this.handleSubmit=this.handleSubmit.bind(this),this.update(s||{})}get state(){return this.store.state}runValidator(s){return Re(s.validate)?L[s.type](s.value,s.validate):s.validate(s.value)}async handleSubmit(s){var r,e,t,a,o,n,d,f;if(this.baseStore.setState(u=>({...u,isSubmitted:!1,submissionAttempts:u.submissionAttempts+1,isSubmitSuccessful:!1})),O(()=>{Object.values(this.fieldInfo).forEach(u=>{u.instance&&(u.instance.state.meta.isTouched||u.instance.setMeta(l=>({...l,isTouched:!0})))})}),!this.state.canSubmit)return;this.baseStore.setState(u=>({...u,isSubmitting:!0}));const c=()=>{this.baseStore.setState(u=>({...u,isSubmitting:!1}))};if(await this.validateAllFields("submit"),!this.state.isFieldsValid){c(),(e=(r=this.options).onSubmitInvalid)==null||e.call(r,{value:this.state.values,formApi:this});return}if(await this.validate("submit"),!this.state.isValid){c(),(a=(t=this.options).onSubmitInvalid)==null||a.call(t,{value:this.state.values,formApi:this});return}O(()=>{Object.values(this.fieldInfo).forEach(u=>{var l,v,h;(h=(v=(l=u.instance)==null?void 0:l.options.listeners)==null?void 0:v.onSubmit)==null||h.call(v,{value:u.instance.state.value,fieldApi:u.instance})})}),(n=(o=this.options.listeners)==null?void 0:o.onSubmit)==null||n.call(o,{formApi:this});try{await((f=(d=this.options).onSubmit)==null?void 0:f.call(d,{value:this.state.values,formApi:this,meta:s??this.options.onSubmitMeta})),O(()=>{this.baseStore.setState(u=>({...u,isSubmitted:!0,isSubmitSuccessful:!0})),c()})}catch(u){throw this.baseStore.setState(l=>({...l,isSubmitSuccessful:!1})),c(),u}}setErrorMap(s){O(()=>{Object.entries(s).forEach(([r,e])=>{const t=r;if(le(e)){const{formError:a,fieldErrors:o}=Q(e);for(const n of Object.keys(this.fieldInfo))this.getFieldMeta(n)&&this.setFieldMeta(n,f=>({...f,errorMap:{...f.errorMap,[t]:o==null?void 0:o[n]},errorSourceMap:{...f.errorSourceMap,[t]:"form"}}));this.baseStore.setState(n=>({...n,errorMap:{...n.errorMap,[t]:a}}))}else this.baseStore.setState(a=>({...a,errorMap:{...a.errorMap,[t]:e}}))})})}}function Q(i){if(i){if(le(i)){const s=Q(i.form).formError,r=i.fields;return{formError:s,fieldErrors:r}}return{formError:i}}return{formError:void 0}}function J(i){switch(i){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"change":default:return"onChange"}}class vt{constructor(s){this.options={},this.mount=()=>{var r,e;const t=this.store.mount();this.options.defaultValue!==void 0&&this.form.setFieldValue(this.name,this.options.defaultValue,{dontUpdateMeta:!0});const a=this.getInfo();a.instance=this,this.update(this.options);const{onMount:o}=this.options.validators||{};if(o){const n=this.runValidator({validate:o,value:{value:this.state.value,fieldApi:this,validationSource:"field"},type:"validate"});n&&this.setMeta(d=>({...d,errorMap:{...d==null?void 0:d.errorMap,onMount:n},errorSourceMap:{...d==null?void 0:d.errorSourceMap,onMount:"field"}}))}return(e=(r=this.options.listeners)==null?void 0:r.onMount)==null||e.call(r,{value:this.state.value,fieldApi:this}),t},this.update=r=>{this.options=r;const e=this.name!==r.name;if(this.name=r.name,this.state.value===void 0){const t=W(r.form.options.defaultValues,r.name),a=r.defaultValue??t;e?this.setValue(o=>o||a,{dontUpdateMeta:!0}):a!==void 0&&this.setValue(a,{dontUpdateMeta:!0})}this.form.getFieldMeta(this.name)===void 0&&this.setMeta(this.state.meta)},this.getValue=()=>this.form.getFieldValue(this.name),this.setValue=(r,e)=>{this.form.setFieldValue(this.name,r,e),this.triggerOnChangeListener(),this.validate("change")},this.getMeta=()=>this.store.state.meta,this.setMeta=r=>this.form.setFieldMeta(this.name,r),this.getInfo=()=>this.form.getFieldInfo(this.name),this.pushValue=(r,e)=>{this.form.pushFieldValue(this.name,r,e),this.triggerOnChangeListener()},this.insertValue=(r,e,t)=>{this.form.insertFieldValue(this.name,r,e,t),this.triggerOnChangeListener()},this.replaceValue=(r,e,t)=>{this.form.replaceFieldValue(this.name,r,e,t),this.triggerOnChangeListener()},this.removeValue=(r,e)=>{this.form.removeFieldValue(this.name,r,e),this.triggerOnChangeListener()},this.swapValues=(r,e,t)=>{this.form.swapFieldValues(this.name,r,e,t),this.triggerOnChangeListener()},this.moveValue=(r,e,t)=>{this.form.moveFieldValues(this.name,r,e,t),this.triggerOnChangeListener()},this.clearValues=r=>{this.form.clearFieldValues(this.name,r),this.triggerOnChangeListener()},this.getLinkedFields=r=>{const e=Object.values(this.form.fieldInfo),t=[];for(const a of e){if(!a.instance)continue;const{onChangeListenTo:o,onBlurListenTo:n}=a.instance.options.validators||{};r==="change"&&(o!=null&&o.includes(this.name))&&t.push(a.instance),r==="blur"&&(n!=null&&n.includes(this.name))&&t.push(a.instance)}return t},this.validateSync=(r,e)=>{var t;const a=ne(r,this.options),n=this.getLinkedFields(r).reduce((c,u)=>{const l=ne(r,u.options);return l.forEach(v=>{v.field=u}),c.concat(l)},[]);let d=!1;O(()=>{const c=(u,l)=>{var v;const h=Z(l.cause),m=l.validate?Fe(u.runValidator({validate:l.validate,value:{value:u.store.state.value,validationSource:"field",fieldApi:u},type:"validate"})):void 0,p=e[h],{newErrorValue:g,newSource:M}=be({formLevelError:p,fieldLevelError:m});((v=u.state.meta.errorMap)==null?void 0:v[h])!==g&&u.setMeta(y=>({...y,errorMap:{...y.errorMap,[h]:g},errorSourceMap:{...y.errorSourceMap,[h]:M}})),g&&(d=!0)};for(const u of a)c(this,u);for(const u of n)u.validate&&c(u.field,u)});const f=Z("submit");return(t=this.state.meta.errorMap)!=null&&t[f]&&r!=="submit"&&!d&&this.setMeta(c=>({...c,errorMap:{...c.errorMap,[f]:void 0},errorSourceMap:{...c.errorSourceMap,[f]:void 0}})),{hasErrored:d}},this.validateAsync=async(r,e)=>{const t=oe(r,this.options),a=await e,o=this.getLinkedFields(r),n=o.reduce((l,v)=>{const h=oe(r,v.options);return h.forEach(m=>{m.field=v}),l.concat(h)},[]);this.state.meta.isValidating||this.setMeta(l=>({...l,isValidating:!0}));for(const l of o)l.setMeta(v=>({...v,isValidating:!0}));const d=[],f=[],c=(l,v,h)=>{const m=Z(v.cause),p=l.getInfo().validationMetaMap[m];p==null||p.lastAbortController.abort();const g=new AbortController;this.getInfo().validationMetaMap[m]={lastAbortController:g},h.push(new Promise(async M=>{var y;let V;try{V=await new Promise((S,R)=>{this.timeoutIds.validations[v.cause]&&clearTimeout(this.timeoutIds.validations[v.cause]),this.timeoutIds.validations[v.cause]=setTimeout(async()=>{if(g.signal.aborted)return S(void 0);try{S(await this.runValidator({validate:v.validate,value:{value:l.store.state.value,fieldApi:l,signal:g.signal,validationSource:"field"},type:"validateAsync"}))}catch(j){R(j)}},v.debounceMs)})}catch(S){V=S}if(g.signal.aborted)return M(void 0);const w=Fe(V),I=(y=a[this.name])==null?void 0:y[m],{newErrorValue:_,newSource:D}=be({formLevelError:I,fieldLevelError:w});l.setMeta(S=>({...S,errorMap:{...S==null?void 0:S.errorMap,[m]:_},errorSourceMap:{...S.errorSourceMap,[m]:D}})),M(_)}))};for(const l of t)l.validate&&c(this,l,d);for(const l of n)l.validate&&c(l.field,l,f);let u=[];(d.length||f.length)&&(u=await Promise.all(d),await Promise.all(f)),this.setMeta(l=>({...l,isValidating:!1}));for(const l of o)l.setMeta(v=>({...v,isValidating:!1}));return u.filter(Boolean)},this.validate=(r,e)=>{var t;if(!this.state.meta.isTouched)return[];const{fieldsErrorMap:a}=e!=null&&e.skipFormValidation?{fieldsErrorMap:{}}:this.form.validateSync(r),{hasErrored:o}=this.validateSync(r,a[this.name]??{});if(o&&!this.options.asyncAlways)return(t=this.getInfo().validationMetaMap[Z(r)])==null||t.lastAbortController.abort(),this.state.meta.errors;const n=e!=null&&e.skipFormValidation?Promise.resolve({}):this.form.validateAsync(r);return this.validateAsync(r,n)},this.handleChange=r=>{this.setValue(r)},this.handleBlur=()=>{this.state.meta.isTouched||(this.setMeta(e=>({...e,isTouched:!0})),this.validate("change")),this.state.meta.isBlurred||this.setMeta(e=>({...e,isBlurred:!0})),this.validate("blur"),this.triggerOnBlurListener()},this.parseValueWithSchema=r=>L.validate({value:this.state.value,validationSource:"field"},r),this.parseValueWithSchemaAsync=r=>L.validateAsync({value:this.state.value,validationSource:"field"},r),this.form=s.form,this.name=s.name,this.timeoutIds={validations:{},listeners:{},formListeners:{}},this.store=new se({deps:[this.form.store],fn:()=>{const r=this.form.getFieldValue(this.name),e=this.form.getFieldMeta(this.name)??{...X,...s.defaultMeta};return{value:r,meta:e}}}),this.options=s}get state(){return this.store.state}runValidator(s){return Re(s.validate)?L[s.type](s.value,s.validate):s.validate(s.value)}setErrorMap(s){this.setMeta(r=>({...r,errorMap:{...r.errorMap,...s}}))}triggerOnBlurListener(){var s,r,e,t,a,o;const n=(s=this.form.options.listeners)==null?void 0:s.onBlurDebounceMs;n&&n>0?(this.timeoutIds.formListeners.blur&&clearTimeout(this.timeoutIds.formListeners.blur),this.timeoutIds.formListeners.blur=setTimeout(()=>{var f,c;(c=(f=this.form.options.listeners)==null?void 0:f.onBlur)==null||c.call(f,{formApi:this.form,fieldApi:this})},n)):(e=(r=this.form.options.listeners)==null?void 0:r.onBlur)==null||e.call(r,{formApi:this.form,fieldApi:this});const d=(t=this.options.listeners)==null?void 0:t.onBlurDebounceMs;d&&d>0?(this.timeoutIds.listeners.blur&&clearTimeout(this.timeoutIds.listeners.blur),this.timeoutIds.listeners.blur=setTimeout(()=>{var f,c;(c=(f=this.options.listeners)==null?void 0:f.onBlur)==null||c.call(f,{value:this.state.value,fieldApi:this})},d)):(o=(a=this.options.listeners)==null?void 0:a.onBlur)==null||o.call(a,{value:this.state.value,fieldApi:this})}triggerOnChangeListener(){var s,r,e,t,a,o;const n=(s=this.form.options.listeners)==null?void 0:s.onChangeDebounceMs;n&&n>0?(this.timeoutIds.formListeners.blur&&clearTimeout(this.timeoutIds.formListeners.blur),this.timeoutIds.formListeners.blur=setTimeout(()=>{var f,c;(c=(f=this.form.options.listeners)==null?void 0:f.onChange)==null||c.call(f,{formApi:this.form,fieldApi:this})},n)):(e=(r=this.form.options.listeners)==null?void 0:r.onChange)==null||e.call(r,{formApi:this.form,fieldApi:this});const d=(t=this.options.listeners)==null?void 0:t.onChangeDebounceMs;d&&d>0?(this.timeoutIds.listeners.change&&clearTimeout(this.timeoutIds.listeners.change),this.timeoutIds.listeners.change=setTimeout(()=>{var f,c;(c=(f=this.options.listeners)==null?void 0:f.onChange)==null||c.call(f,{value:this.state.value,fieldApi:this})},d)):(o=(a=this.options.listeners)==null?void 0:a.onChange)==null||o.call(a,{value:this.state.value,fieldApi:this})}}function Fe(i){if(i)return i}function Z(i){switch(i){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"change":default:return"onChange"}}function mt(i){const[s,r]=K(i,{equals:!1}),e=i.store.subscribe(()=>r(i));return P(e),s}function je(i){const s=i(),r=new vt(s),e=r;e.Field=Ke;let t=!1;return Te(()=>{const a=r.mount();t=!0,P(()=>{a(),t=!1})}),xe(()=>{t&&r.update(i())}),mt(e)}function Ke(i){const s=je(()=>{const{children:r,...e}=i;return e});return Ce(()=>E(()=>i.children(s),{}))}function Vt(i){const s=i==null?void 0:i(),r=new ht(s),e=r;return e.Field=t=>E(Ke,A(t,{form:r})),e.createField=t=>je(()=>({...t(),form:r})),e.useStore=t=>pe(r.store,t),e.Subscribe=t=>ve(t.children,pe(r.store,t.selector)),Te(r.mount),xe(()=>r.update(i==null?void 0:i())),e}export{Je as F,tt as S,bt as T,Ft as a,yt as b,Vt as c,St as d,Be as e,Ze as f,ue as g,de as h,He as i,Ge as j,Qe as k,De as l,Pe as m,q as u};
